const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header, .draft").toggleClass("blur"):$(".wrapper, .header, .draft").toggleClass("blur"),$(".wrapper *").removeClass("translateXbackwards")};$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out")});let mousePosition={};const getMousePosition=()=>{$(window).mousemove(e=>{mousePosition.y=e.pageY}),mousePosition.y>$(window).height()/100*80&&(mousePosition.y=mousePosition.y-($(".context.flex").height()+50))},handleHomeBtnClick=(e,t)=>{const a=e=>{$(".requestTypeChoice").addClass("hidden").removeClass("flex"),"outRequests"===e||"inRequests"===e?$(`.${e}__step1`).removeClass("hidden").addClass("flex"):"loan"===e&&$(".requestTypeChoice").hasClass("newRequest")?$(".inRequests__step1").removeClass("hidden").addClass("flex"):"borrowing"===e&&$(".requestTypeChoice").hasClass("newRequest")&&$(".outRequests__step1").removeClass("hidden").addClass("flex")};$(`.home__${t}__${e}`).click(()=>{"newRequest"===e?($(".requestTypeChoice").addClass(e+" flex").removeClass("hidden"),$(".requestTypeChoice__btnContainer__loan").click(()=>{$(".inRequests__form__pibInfo__outProvince").prop("checked",!1),a("loan")}),$(".requestTypeChoice__btnContainer__borrowing").click(()=>{a("borrowing")})):"followRequest"===e?$(".inRequests__step3").removeClass("hidden").addClass("flex"):"outReturns"===e?$(".outReturns__step1").removeClass("hidden").addClass("flex"):"inReturns"===e&&$(".inReturns__step1").removeClass("hidden").addClass("flex"),$(".home").addClass("hidden").removeClass("flex"),$(".returnIcon, .header__container__msg").removeClass("hidden")})};handleHomeBtnClick("newRequest","btnContainer"),handleHomeBtnClick("followRequest","btnContainer"),handleHomeBtnClick("inReturns","btnContainer"),handleHomeBtnClick("outReturns","btnContainer");const socket=io();let inRequestsReaderGender,barcodeOptions={format:"CODE39",lineColor:"#000000",displayValue:!0},data2send={table:"",values:[],authorFirstName:!0};const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;const handleSimpleStep=(e,t,a,s)=>{$(`${e}__${t}__${s}`).click(()=>{validationErr||($(`${e}__${t}`).toggleClass("translateXbackwards hidden flex"),".inRequests__step3"==`${e}__${t}`&&$(".inRequests__step4 input").val(""),$(`${e}__${a}`).removeClass("translateXonwards hidden").toggleClass("fixed flex"))})};handleSimpleStep(".inRequests","step1","step2","confirmation"),handleSimpleStep(".inRequests","step3","step4","confirmation"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".outRequests","step3","step4","btn"),handleSimpleStep(".inReturns","step1","step2","btn"),handleSimpleStep(".inReturns","step2","step3","confirmation"),handleSimpleStep(".outReturns","step1","step2","btn"),handleSimpleStep(".outReturns","step2","step3","confirmation"),$(".returnIcon").click(()=>{const e=(e,t)=>{var a;e.match(/(step1|requestTypeChoice|inRequests__step3)/gi)?$(e).is(":visible")&&!e.match(/(inRequests__step1|inRequests__step2|outRequests)/gi)||"inRequests__step3"===e?(a=e,$(a).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").addClass("hidden").removeClass("flex"),setTimeout(()=>{$(a).toggleClass("translateXonwards flex")},500),$(".requestTypeChoice").removeClass("newRequest")):$(e).is(":visible")&&e.match(/(inRequests|outRequests)/gi)&&"inRequests__step3"!==e&&($(e).removeClass("translateXbackwards translateXonwards flex").addClass("hidden"),$(".requestTypeChoice").hasClass("newRequest")&&$(".requestTypeChoice").addClass("flex").removeClass("hidden")):$(e).is(":visible")&&($(e).addClass("translateXonwards hidden").removeClass("flex"),$(t).removeClass("translateXbackwards hidden").addClass("flex"))};e(".inReturns__step1"),e(".outReturns__step1"),e(".addReader__step1"),e(".requestTypeChoice"),e(".inRequests__step3"),e(".outRequests__step1",".requestTypeChoice"),e(".inRequests__step1",".requestTypeChoice"),e(".outRequests__step2",".outRequests__step1"),e(".outRequests__step3",".outRequests__step2"),e(".outRequests__step4",".outRequests__step3"),e(".inRequests__step2",".inRequests__step1"),e(".inRequests__step4",".inRequests__step3"),e(".inReturns__step2",".inReturns__step1"),e(".inReturns__step3",".inReturns__step2"),e(".outReturns__step2",".outReturns__step1"),e(".outReturns__step3",".outReturns__step2")}),$(".menu__item").click(()=>{$(".header__menu__switch").prop("checked")&&$(".header__menu__switch").prop("checked",!1)});const invalid=e=>{e.addClass("invalid"),validationErr=!0};socket.on("notification",e=>{"success"===e.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===e.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationSuccess").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")):"info"===e.type?($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").removeClass("notificationSuccess notificationMail notificationFailure").addClass("notificationInfo"),$(".notification__msg").text("Aucune donnÃ©e correspondante n'a Ã©tÃ© trouvÃ©e... ðŸ˜¶")):"mail"===e.type?($(".notification__icon").attr("src","./src/scss/icons/mail.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationMail"),$(".notification__msg").text("Mail envoyÃ© au lecteur ðŸ˜Ž")):"barcode"===e.type&&($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationFailure"),$(".notification__msg").text("Plus aucun code-barres n'est disponible... ðŸ˜¶"),$(".inRequests__barcode__svg").remove(),$(".inRequests__form__docInfo__inv").val("")),$(".notification").removeClass("hidden").addClass("flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo flex").addClass("hidden")}))},5e3)});const smartHide=(e,t,a)=>{"in"===t?($(e).toggleClass("hidden flex"),$(".wrapper, .header").addClass("blur")):($(e).toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header").toggleClass("blur"):$(".wrapper, .header").toggleClass("blur"),void 0!==a&&clearTimeout(a))},addReader=()=>{let e,t=$(".addReader__step1__form__nameContainer__readerName"),a=$(".addReader__step1__form__nameContainer__readerFirstName"),s=$(".addReader__step1__form__email__input"),_="";$(".addReader__step1__form__btnContainer__submit").click(n=>{if(n.preventDefault(),data2send.table="readers",$(".addReader__step1__form input.radio").each((function(){$(this).is(":checked")&&(_=$(this).val())})),""===t.val()&&invalid(t),""===a.val()&&invalid(a),s.is(":invalid")&&invalid(s),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addReader__step1__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout((function(){data2send.values.push(`${capitalizeFirstLetter(t.val())}, ${capitalizeFirstLetter(a.val())}`),""!==s.val()&&data2send.values.push("mailto:"+s.val()),data2send.values.push(_),socket.emit("append data",data2send),data2send.values=[],$(".addReader__step1").removeAttr("style").toggleClass("hidden flex"),confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),$(".addReader__step1 input").not(".radio").val("")}),5e3)}),$(".addReader__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};$(".addReaderLink").click(()=>{$(".home, .returnIcon, .header__container__msg, .addReader__step1").toggleClass("hidden flex"),addReader()});const autocomplete=(e,t)=>{$(e).on("keydown",(function(){let e=$(this);socket.emit("retrieve readers",e.val()),""===e.val()&&($(t).empty().toggleClass("hidden flex"),e.removeAttr("style"))})),socket.on("readers retrieved",a=>{a!==[]&&($(e).css({marginBottom:0,borderBottom:"2px solid transparent"}),$(e).ready(()=>{let a=$(e).position();$(t).css({left:a.left,top:a.top+$(e).outerHeight()+12,width:$(e).outerWidth()})}),$(t).empty().addClass("flex").removeClass("hidden"));for(const s of a){$("<p></p>").append(s.name).addClass(s.name.match(/[^,\s]/gi).join("")).appendTo(t).click((function(){$(e).val($(this).text()).removeAttr("style"),$(t).toggleClass("hidden flex").empty(),".inRequests__step4__container__reader"===e&&(socket.emit("mail request",$(this).text()),socket.on("mail retrieved",e=>{$(".inRequests__step4__container__mail").val(e.mail),inRequestsReaderGender=e.gender[0]}))}))}}),$(e).on("focusout",()=>{$(e).removeAttr("style",()=>{$(t).toggleClass("hidden flex")})}),$(t).focusout((function(){$(this).toggleClass("hidden flex")}))},setDate=()=>{$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`)},setDay=e=>e.getDate()<10?"0"+e.getDate():e.getDate(),setMonth=e=>e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`);const exportDB=()=>{let e="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(e=$(this).val())})),socket.emit("export db",e),e=""};$(".exportsLink").click(()=>{smartHide(".export","in"),format=""}),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),socket.on("export successfull",()=>{smartHide(".export","out"),window.open("/download")});const draftNewRequest=()=>{let e,t=".draft__child__container__reader__name input",a=".draft__child__container__reader__date input",s=".draft__child__container__reader__bookTitle input",_=$(".draft__child__container__comment__textarea");$(".draftsLink").click(()=>{$(".draft__child__container input[type=text], .draft__child__container textarea").val(""),smartHide(".draft","in")}),autocomplete(".draft__child__container__reader__name input",".draft__child__container__reader__label__autocomplete"),$(".draft__child__container__reader").submit(n=>{if(n.preventDefault(),data2send.table="drafts",""===$(t).val()&&invalid($(t)),""===$(a).val()&&invalid($(a)),""===$(s).val()&&invalid($(s)),validationErr){if(!$(".draft__child__container__reader .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".draft__child__container__reader")}validationErr=!1}else $(".input").removeClass("invalid"),$(".draft__child__container__reader .warning").remove(),confirmation(),$(t).val($(t).val().replace(/'/g,"''")),$(s).val($(s).val().replace(/'/g,"''")),_.val(_.val().replace(/'/g,"''")),e=setTimeout(()=>{data2send.values.push($(t).val()),data2send.values.push(new Date($(a).val()).toUTCString()),data2send.values.push($(s).val()),""!==_.val()?data2send.values.push(_.val()):data2send.values.push("/"),socket.emit("append data",data2send),data2send.values=[],smartHide(".draft","out"),confirmation(),$(".draft__child__container .input, .draft__child__container textarea").not(".draft__child__container__reader__date input").val("")},5e3);data2send.values=[]}),$(".draft__child__container__reader__btnContainer__reset").click(()=>{$(".draft").toggleClass("hidden flex"),$(".wrapper, .header").removeClass("blur"),$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$(".draft").removeClass("blur")})};let initialPibNb,initialBarcode;draftNewRequest();const inRequests=()=>{let e,t=$(".inRequests__form__docInfo__inv");autocomplete(".inRequests__form__readerInfo__container__name",".inRequests__form__readerInfo__container__autocomplete"),autocomplete(".inRequests__step4__container__reader",".inRequests__step4__container__autocomplete"),socket.on("barcode",e=>{initialBarcode=e,t.val(e),JsBarcode(".inRequests__barcode__svg",e,barcodeOptions)});let a=$(".inRequests__form__readerInfo__container__name"),s=$(".inRequests__form__pibInfo__pibNb"),_=$(".inRequests__form__pibInfo__borrowingLibrary"),n=$(".inRequests__form__pibInfo__requestDate"),i=$(".inRequests__form__pibInfo__loanLibrary"),r=$(".inRequests__form__docInfo__title"),o=$(".inRequests__form__docInfo__author"),l=$(".inRequests__form__docInfo__cdu"),d="";$(".inRequests__form__docInfo__inv").on("input",(function(){$(this).val().length<14?($(this).addClass("invalid"),validationErr=!0):14===$(this).val().length&&$(this).val()!==initialBarcode?$(".inRequests").hasClass("absolute")?socket.emit("barcode verification",{code:$(this).val(),pib_number:initialPibNb}):""!==s.val()&&socket.emit("barcode verification",{code:$(this).val(),pib_number:s.val()}):$(this).val()===initialBarcode&&($(this).removeClass("invalid"),validationErr=!1,$("form .warning").remove(),JsBarcode(".inRequests__barcode__svg",initialBarcode,barcodeOptions))})),socket.on("barcode verified",e=>{if("used"!==e||e===initialBarcode)$(this).removeClass("invalid"),validationErr=!1,$("form .warning").remove(),JsBarcode(".inRequests__barcode__svg",e,barcodeOptions);else if(validationErr=!0,!$("form .warning").length){$("<span></span>").addClass("warning").text("Ce code-barres est dÃ©jÃ  pris ou n'existe pas...").appendTo(".inRequests__form")}}),$(".inRequests__form__btnContainer__submit").click(c=>{if(c.preventDefault(),data2send.table="in_requests",s.val().match(/\d{6}/)&&!s.val().match(/\d{7,}/)||invalid(s),""===_.val()&&invalid(_),""===n.val()&&invalid(n),""===i.val()&&invalid(i),""===a.val()&&invalid(a),""===r.val()&&invalid(r),""!==o.val()?-1!==o.val().indexOf(",")?(d=o.val().split(","),d=`${d[0].toUpperCase().trim()}, ${d[1].trim()}`):d=o.val():invalid(o),""===l.val()&&invalid(l),""===t.val()||14!==t.val().length?invalid(t):$(".inRequests").hasClass("absolute")?socket.emit("barcode verification",{code:t.val(),pib_number:initialPibNb}):""!==s.val()&&socket.emit("barcode verification",{code:t.val(),pib_number:s.val()}),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1,data2send.values=[]}else{$(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),$(".inRequests").hasClass("absolute")||$(".inRequests__step2").removeClass("translateXonwards translateXbackwards hidden fixed").addClass("flex");let o=$(".inRequests__form__pibInfo__outProvince").is(":checked");_.val(_.val().replace(/'/g,"''")),i.val(i.val().replace(/'/g,"''")),a.val(a.val().replace(/'/g,"''")),r.val(r.val().replace(/'/g,"''")),e=setTimeout(()=>{data2send.values.push(s.val()),data2send.values.push(_.val()),data2send.values.push(new Date(n.val()).toUTCString()),data2send.values.push(i.val()),data2send.values.push(a.val()),data2send.values.push(r.val()),-1===d.indexOf(",")?(data2send.authorFirstName=!1,data2send.values.push(d)):(d=d.split(","),d[0]=d[0].replace(/'/g,"''"),data2send.values.push(d[0].trim(),d[1].trim())),data2send.values.push(l.val()),data2send.values.push(o),data2send.values.push(t.val()),$(".inRequests").hasClass("absolute")?(data2send.key=initialPibNb,data2send.barcode=initialBarcode,$(".inRequests.absolute").toggleClass("hidden flex"),$(".wrapper").toggleClass("backgroundColor blur"),socket.emit("update",data2send),$(".inRequests.absolute .inRequests__form__btnContainer__hide").toggleClass("hidden")):(socket.emit("append data",data2send),$(".inRequests__step2").toggleClass("hidden flex"),$(".inRequests__step2__barcode .inRequests__barcode__svg").remove(),$(".inRequests__form .input").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")),confirmation(),data2send.values=[]},5e3)}}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".inRequests__step4__btn").click(()=>{confirmation(),e=setTimeout(()=>{confirmation(),$(".inRequests__step4").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),setTimeout(()=>{socket.emit("send mail",{name:$(".inRequests__step4__container__reader").val(),mail:$(".inRequests__step4__container__mail").val(),gender:inRequestsReaderGender,request:$(".inRequests__step4__container__title").val()})},1e3)},5e3)}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};inRequests(),$(".leaveLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".leave").toggleClass("hidden flex"),$(".leave").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))})),$(".shutdownBtn").click(()=>{socket.emit("shutdown")}),$(".restartBtn").click(()=>{socket.emit("restart"),setTimeout(()=>{location.reload()},1e4)})});const outRequests=()=>{let e,t=$(".outRequests__form__pibInfo__pibNb"),a=$(".outRequests__form__pibInfo__borrowingLibrary"),s=$(".outRequests__form__pibInfo__requestDate"),_=$(".outRequests__form__pibInfo__loanLibrary"),n=$(".outRequests__form__docInfo__title"),i=$(".outRequests__form__docInfo__author"),r=$(".outRequests__form__docInfo__cdu"),o="";$(".outRequests__form__btnContainer__submit").click(l=>{if(l.preventDefault(),data2send.table="out_requests",t.val().match(/\d{6}/)&&!t.val().match(/\d{7,}/)||invalid(t),""===a.val()&&invalid(a),""===s.val()&&invalid(s),""===_.val()&&invalid(_),""===n.val()&&invalid(n),""===i.val()&&invalid(i),""===r.val()&&invalid(r),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".outRequests__form")}validationErr=!1,data2send.values=[]}else{$(".input").removeClass("invalid"),$("form .warning").hide(),a.val(a.val().replace(/'/g,"''")),_.val(_.val().replace(/'/g,"''")),n.val(n.val().replace(/'/g,"''"));let l=$(".outRequests__form__pibInfo__outProvince").is(":checked");confirmation(),e=setTimeout(()=>{data2send.values.push(t.val()),data2send.values.push(a.val()),data2send.values.push(new Date(s.val()).toUTCString()),data2send.values.push(_.val()),data2send.values.push(n.val()),-1!==i.val().indexOf(",")?(o=i.val().split(","),o[0]=o[0].replace(/'/g,"''"),data2send.values.push(o[0].toUpperCase().trim(),o[1].trim())):(o=i.val(),data2send.values.push(o),data2send.authorFirstName=!1),data2send.values.push(r.val()),data2send.values.push(l),socket.emit("append data",data2send),data2send.values=[],$(".outRequests__step4").toggleClass("hidden flex"),confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),$(".outRequests__form .input").not(".outRequests__form__pibInfo__requestDate, .outRequests__form__pibInfo__loanLibrary").val("")},5e3)}}),$(".outRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{clearTimeout(e)})};outRequests();const returnDocument=(e,t)=>{let a;$(t).click(()=>{confirmation(),a=setTimeout(()=>{$(e).toggleClass("hidden flex"),confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")},5e3)}),$(".confirmation__body__cancel").click(()=>{clearTimeout(a)})},sendDeletion=e=>{$(e+"__btn").click(t=>{t.preventDefault();let a="";a=".outReturns__step3"===e?"out_requests":"in_requests",socket.emit("delete data",{table:a,data:$(e+"__input").val()})})};returnDocument(".inReturns__step3",".inReturns__step3__confirmation"),returnDocument(".outReturns__step3",".outReturns__step3__confirmation"),sendDeletion(".outReturns__step3"),sendDeletion(".inReturns__step3");const search=()=>{let e,t,a={},s={table:"",reader:"",title:"",getReader:!1,getTitle:!0};const _=(e,t,a,s)=>{let _=document.querySelector(`.${t} ${a}`);_.select(),_.setSelectionRange(0,99999),document.execCommand("copy");let n=e.attr("class").split(" ");setTimeout(()=>{$(`.${n[1]} p`).text(s)},1500)};$(".search__container__select").on("change",(function(){"out_requests"===$(this).val()?($(".search__container__readerInput").attr("disabled",!0),$(".search__container__titleInput").attr("disabled",!1)):"in_requests"===$(this).val()||"drafts"===$(this).val()?$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!1):"default"===$(this).val()&&$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!0)})),$(".search__container").submit(e=>{e.preventDefault(),s.getReader=s.getTitle=!1,"default"!==$(".search__container__select").val()&&(s.table=$(".search__container__select").val(),""!==$(".search__container__readerInput").val()&&(s.getReader=!0,s.reader=$(".search__container__readerInput").val().replace(/\'/g,"''")),""!==$(".search__container__titleInput").val()&&(s.getTitle=!0,s.title=$(".search__container__titleInput").val().replace(/\'/g,"''")),socket.emit("search",s),s.table=s.reader=s.title="",s.getReader=s.getTitle=!1)}),socket.on("search results",s=>{let n;if($(".search__results__container").empty((function(){$(this).fadeOut()})),void 0!==s[0]){let i=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[e,t]of Object.keys(s[0]).entries()){let e=t;if("in_requests"===$(".search__container__select").val()?"borrowing_library"===t&&(e="PrÃªteur"):"out_requests"===$(".search__container__select").val()&&"borrowing_library"===t&&(e="Emprunteur"),"loan_library"!==t&&"book_author_firstname"!==t){switch(t){case"pib_number":e="NÂ° PIB";break;case"request_date":e="Date";break;case"book_title":e="Titre";break;case"book_author_name":e="Auteur";break;case"cdu":e="CDU";break;case"out_province":e="Hors Province ?";break;case"barcode":e="NÂ° inv.";break;case"id":e="NÂ° de demande";break;case"comment":e="Commentaires";break;case"reader_name":e="Lecteur"}$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(i)}}for(const[e,t]of s.entries()){let a=$("<span></span>").addClass(`search__results__container__row search__results__container__row--${e} flex`).appendTo(".search__results__container");if(void 0!==t.id){$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--id").append(t.id).appendTo(a)}if(void 0!==t.pib_number){$("<input>").addClass("search__results__container__row__item search__results__container__row__item--pib noInput").val(t.pib_number).appendTo(a)}if(void 0!==t.borrowing_library){$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--borrowing_library").append(t.borrowing_library.replace(/\'\'/g,"'")).appendTo(a)}let s=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--date"),_=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--timestamp hidden");if(null!==t.request_date?(s.append(new Date(t.request_date).toLocaleDateString()),_.append(t.request_date.split("T")[0])):s.append("ProblÃ¨me d'affichage..."),_.appendTo(a),s.appendTo(a),void 0!==t.reader_name){$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--reader").append(t.reader_name.replace(/\'\'/g,"'")).appendTo(a)}$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--title").append(t.book_title.replace(/\'\'/g,"'")).appendTo(a);let n=$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--author");if(void 0===t.book_author_name&&void 0===t.book_author_firstname||(void 0!==t.book_author_firstname&&null!==t.book_author_firstname?n.append(`${t.book_author_name.replace(/\'\'/g,"'")}, ${t.book_author_firstname}`):n.append(t.book_author_name.replace(/\'\'/g,"'")),n.appendTo(a)),void 0!==t.cdu){$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--cdu").append(t.cdu).appendTo(a)}let i=$('      <svg xmlns="http://www.w3.org/2000/svg">        <circle cx="50%" cy="50%" r="5"/>      </svg>      ').addClass("search__results__container__row__item search__results__container__row__item--op flex");if(void 0!==t.out_province&&(i.attr("viewBox","0 0 75 10").appendTo(a),t.out_province?i.removeClass("unchecked").addClass("checked"):i.removeClass("checked").addClass("unchecked")),void 0!==t.barcode){$("<input>").addClass("search__results__container__row__item search__results__container__row__item--code noInput").val(t.barcode).appendTo(a)}if(void 0!==t.comment){$("<span></span>").addClass("search__results__container__row__item search__results__container__row__item--comment").append(t.comment.replace(/\n/gi,"<br>")).appendTo(a)}}$(".search__results__container").fadeIn(),$(".search__results__container__row").contextmenu((function(e){const t=t=>{$(".context").css({left:e.pageX+"px",top:t+"px"}).toggleClass("hidden flex")};$(window).mousemove(e=>{mousePosition.y=e.pageY}),mousePosition.y>$(window).height()/100*80&&(mousePosition.y=mousePosition.y-($(".context.flex").height()+50)),n=$(this).attr("class").split(" ")[1],"drafts"===$(".search__container__select").val()?($(".context__list__item--pib, .context__list__item--inv").addClass("hidden").removeClass("flex"),$(".context__list__item--del").addClass("context__list__item--bottom")):"out_requests"===$(".search__container__select").val()?$(".context__list__item--modify, .context__list__item--inv").addClass("hidden").removeClass("flex"):($(".context__list__item--pib, .context__list__item--inv, .context__list__item--modify").addClass("flex").removeClass("hidden"),$(".context__list__item--del").removeClass("context__list__item--bottom")),e.preventDefault(),"out_requests"!==$(".search__container__select").val()?t(mousePosition.y):t(e.pageY),$(".search__results, .search__results *").click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item").click(()=>{$(".context").removeClass("flex").addClass("hidden")}),$(".context__list__item--modify").click((function(){let e=$(`.${n} .search__results__container__row__item--timestamp`).text();$(".wrapper").addClass("blur"),"drafts"===$(".search__container__select").val()?($(".draft__child__container__reader__date input").val(e),$(".draft__child__container__reader__name input").val($(`.${n} .search__results__container__row__item--reader`).text()),void 0!==$(`.${n} .search__results__container__row__item--comment`)?$(".draft__child__container__comment__textarea").val($(`.${n} .search__results__container__row__item--comment`).html().replace(/(<|&lt;)br(>|&gt;)/gi,"\n")):location.reload(),$(".draft__child__container__reader__bookTitle input").val($(`.${n} .search__results__container__row__item--title`).text()),$(".draft").removeClass("hidden").addClass("flex"),$(".draft__child__container__reader__btnContainer__submit").click((function(){t=setTimeout((function(){a={table:$(".search__container__select").val(),id:$(`.${n} .search__results__container__row__item--id`).text(),date:new Date($(".draft__child__container__reader__date input").val()).toUTCString(),reader:$(".draft__child__container__reader__name input").val().replace(/\'/g,"''"),comment:$(".draft__child__container__comment__textarea").val().replace(/\'/g,"''"),title:$(".draft__child__container__reader__bookTitle input").val().replace(/\'/g,"''")};let e=a.comment.trim().split("\n");$(e).each((t,a)=>{""===a&&e.splice(t,1,$("<br>")[0])}),$(`.${n} .search__results__container__row__item--date`).text(new Date(a.date).toLocaleDateString()),$(`.${n} .search__results__container__row__item--reader`).text(a.reader.replace(/\'\'/g,"'")),$(`.${n} .search__results__container__row__item--comment`).text(e.join("").replace(/\'\'/g,"'")),$(`.${n} .search__results__container__row__item--title`).text(a.title.replace(/\'\'/g,"'")),socket.emit("update",a)}),5e3),$(".confirmation__body__cancel").click(()=>{$(".draft").removeClass("blur"),clearTimeout(t),t=void 0})}))):"in_requests"===$(".search__container__select").val()&&($(".inRequests").addClass("absolute flex").removeClass("hidden"),initialPibNb=$(`.${n} .search__results__container__row__item--pib`).val(),initialBarcode=$(`.${n} .search__results__container__row__item--code`).val(),$(".inRequests.absolute .inRequests__form__btnContainer__hide").removeClass("hidden"),$(".inRequests.absolute .inRequests__form__pibInfo__pibNb").val($(`.${n} .search__results__container__row__item--pib`).val()),$(".inRequests.absolute .inRequests__form__pibInfo__borrowingLibrary").val($(`.${n} .search__results__container__row__item--borrowing_library`).text()),$(".inRequests.absolute .inRequests__form__pibInfo__requestDate").val(e),$(".inRequests.absolute .inRequests__form__readerInfo__container__name").val($(`.${n} .search__results__container__row__item--reader`).text()),$(".inRequests.absolute .inRequests__form__docInfo__title").val($(`.${n} .search__results__container__row__item--title`).text()),$(".inRequests.absolute .inRequests__form__docInfo__author").val($(`.${n} .search__results__container__row__item--author`).text()),$(".inRequests.absolute .inRequests__form__docInfo__cdu").val($(`.${n} .search__results__container__row__item--cdu`).text()),$(".inRequests.absolute .inRequests__form__docInfo__inv").val($(`.${n} .search__results__container__row__item--code`).val()),$(`.${n} .search__results__container__row__item--op`).hasClass("checked")?$(".inRequests.absolute .inRequests__form__pibInfo__outProvince").prop("checked",!0):$(".inRequests.absolute .inRequests__form__pibInfo__outProvince").prop("checked",!1),JsBarcode(".inRequests.absolute .inRequests__barcode__svg",$(".inRequests.absolute .inRequests__form__docInfo__inv").val(),barcodeOptions),$(".inRequests.absolute .inRequests__form__btnContainer__submit").click(()=>{$(`.${n} .search__results__container__row__item--pib`).val($(".inRequests__form__pibInfo__pibNb").val()),$(`.${n} .search__results__container__row__item--borrowing_library`).text($(".inRequests__form__pibInfo__borrowingLibrary").val()),$(`.${n} .search__results__container__row__item--date`).text(new Date($(".inRequests__form__pibInfo__requestDate").val()).toLocaleDateString()),$(`.${n} .search__results__container__row__item--reader`).text($(".inRequests__form__readerInfo__container__name").val()),$(`.${n} .search__results__container__row__item--title`).text($(".inRequests__form__docInfo__title").val()),$(`.${n} .search__results__container__row__item--author`).text($(".inRequests__form__docInfo__author").val()),$(`.${n} .search__results__container__row__item--cdu`).text($(".inRequests__form__docInfo__cdu").val()),$(`.${n} .search__results__container__row__item--code`).val($(".inRequests__form__docInfo__inv").val()),$(".inRequests__form__pibInfo__outProvince").is(":checked")?$(`.${n} .search__results__container__row__item--op`).removeClass("unchecked").addClass("checked"):$(`.${n} .search__results__container__row__item--op`).removeClass("checked").addClass("unchecked")}),$(".inRequests.absolute .inRequests__form__btnContainer__hide").click((function(){$(".inRequests").removeClass("absolute flex").addClass("hidden"),$(".wrapper").removeClass("blur backgroundColor"),$(this).addClass("hidden")})))})),$(".context__list__item--del").click((function(){let t={};confirmation(),"drafts"===$(".search__container__select").val()?t={table:"drafts",key:$(`.${n} .search__results__container__row__item--id`).text()}:"in_requests"===$(".search__container__select").val()?t={table:"in_requests",key:initialPibNb,code:initialBarcode}:"out_requests"===$(".search__container__select").val()&&(t={table:"out_requests",key:$(`.${n} .search__results__container__row__item--pib`).val()}),$("."+n).toggleClass("hidden flex"),e=setTimeout(()=>{""!==t.table&&""!==t.key&&($("."+n).remove(),confirmation(),socket.emit("delete data",t),t={})},5e3),$(".confirmation__body__cancel").click(()=>{clearTimeout(e),$("."+n).removeClass("hidden").addClass("flex"),e=void 0,t={}})})),$(".context__list__item--inv").click((function(){_($(this),n,".search__results__container__row__item--code","Copier le nÂ° d'inventaire")})),$(".context__list__item--pib").click((function(){_($(this),n,".search__results__container__row__item--pib","Copier le nÂ° PIB")}))}})};search();const settings=()=>{socket.on("settings",e=>{$(".settings__child__textarea__content").val(e.mail_content.toString().replace(/\'\'/g,"'"))}),$(".settingsLink").click(()=>{$(".settings__container").toggleClass("hidden flex"),$(".wrapper").addClass("blur")}),$(".settings__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper").removeClass("blur"),settings.mail_content!==$(".settings__child__textarea__content").val().replace(/\'/g,"''")&&socket.emit("settings",{mail_content:$(".settings__child__textarea__content").val().replace(/\'/g,"''")}))}))};settings();const showAbout=()=>{$(".aboutLink").click(()=>{$(".wrapper, header").toggleClass("blur"),$(".about__container").toggleClass("hidden flex")}),$(".updateBtn").click(()=>{socket.emit("update check")}),socket.on("update progress",e=>{$(".updateBtn").text(e)}),$(".about__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))}))};showAbout();