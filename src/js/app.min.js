const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".wrapper, .header").toggleClass("blur")};const handleHomeBtnClick=(e,n)=>{$(`.home__${n}__${e}`).click(()=>{$(".home").fadeOut(()=>{$(`.${e}__step1`).fadeIn(()=>{$(`.${e}__step1`).toggleClass("hidden flex").removeAttr("style")}),setTimeout(()=>{$(".home").toggleClass("flex hidden").removeAttr("style"),$(".returnIcon, .header__container__msg").removeClass("hidden")},1e3)})})};handleHomeBtnClick("outRequests","btnContainer"),handleHomeBtnClick("inRequests","btnContainer"),handleHomeBtnClick("inReturns","btnContainer"),handleHomeBtnClick("outReturns","btnContainer"),handleHomeBtnClick("addReader","optionsContainer");const socket=io();let data2send={table:"",values:[],authorFirstName:!0};const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let day,month,validationErr=!1;day=(new Date).getDate()<"10"?"0"+(new Date).getDate():(new Date).getDate(),month=(new Date).getMonth()<"10"?"0"+((new Date).getMonth()+1):(new Date).getMonth()+1;const handleSimpleStep=(e,t,s,n)=>{$(`${e}__${t}__${n}`).click(()=>{validationErr||($(`${e}__${t}`).toggleClass("translateXbackwards hidden flex"),setTimeout(()=>{$(`${e}__${s}`).fadeIn().removeAttr("style").removeClass("translateXonwards hidden").toggleClass("fixed flex")},1e3))})};handleSimpleStep(".inRequests","step2","step3","btn"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".inReturns","step1","step2","btn"),handleSimpleStep(".inReturns","step2","step3","confirmation"),handleSimpleStep(".outReturns","step1","step2","btn"),handleSimpleStep(".outReturns","step2","step3","confirmation"),$(".returnIcon").click(()=>{const e=(e,t)=>{var s;e.match("step1")?$(e).is(":visible")&&(s=e,$(s).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").toggleClass("hidden"),setTimeout(()=>{$(s).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).toggleClass("translateXonwards flex hidden"),$(t).removeClass("translateXbackwards").toggleClass("hidden flex"))};e(".outRequests__step1"),e(".inRequests__step1"),e(".inReturns__step1"),e(".outReturns__step1"),e(".addReader__step1"),e(".outRequests__step2",".outRequests__step1"),e(".outRequests__step3",".outRequests__step2"),e(".inRequests__step2",".inRequests__step1"),e(".inRequests__step3",".inRequests__step2"),e(".inReturns__step2",".inReturns__step1"),e(".inReturns__step3",".inReturns__step2"),e(".outReturns__step2",".outReturns__step1"),e(".outReturns__step3",".outReturns__step2")});socket.on("notification",i=>{"success"===i.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===i.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")):"info"===i.type&&($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").addClass("notificationInfo"),$(".notification__msg").text("Aucune donnÃ©e correspondante n'a Ã©tÃ© trouvÃ©e... ðŸ˜¶")),$(".notification").toggleClass("hidden flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo").toggleClass("flex hidden")}))},5e3)});const smartHide=(e,r,s)=>{"in"===r?$(e).fadeIn((function(){$(this).addClass("flex").removeClass("hidden").removeAttr("style"),$(".wrapper, .header").removeClass("blur")})):$(e).fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),void 0!==s&&clearTimeout(s)}))};const addReader=()=>{let e="",a=$(".addReader__step1__form__nameContainer__readerName"),d=$(".addReader__step1__form__nameContainer__readerFirstName"),t=$(".addReader__step1__form__email__input"),n="";$(".addReader__step1__form__btnContainer__submit").click(i=>{if(i.preventDefault(),data2send.table="readers",$(".addReader__step1__form input.radio").each((function(){$(this).is(":checked")&&(n=$(this).val())})),""===a.val()&&invalid(a),""===d.val()&&invalid(d),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addReader__step1__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout((function(){data2send.values.push(`${capitalizeFirstLetter(a.val())}, ${capitalizeFirstLetter(d.val())}`),""!==t.val()&&data2send.values.push("mailto:"+t.val()),data2send.values.push(n),socket.emit("append data",data2send),data2send.values=[],$(".addReader__step1").fadeOut((function(){confirmation(),$(this).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),$(".addReader__step1 input").not(".radio").val("")}))}),5e3)}),$(".addReader__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(e)}))})};addReader();const setDate=()=>{let e,t;e=(new Date).getDate()<"10"?"0"+(new Date).getDate():(new Date).getDate(),t=(new Date).getMonth()<"10"?"0"+((new Date).getMonth()+1):(new Date).getMonth()+1,$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${t}-${e}`)};setDate();const exportDB=()=>{let t="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(t=$(this).val())})),socket.emit("export db",t),t=""};$(".header__actionsContainer__importExport").click(()=>{smartHide(".export","in"),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),format=""});const draftNewRequest=()=>{let a=".draft__child__container__reader__name input",e=".draft__child__container__reader__date input",_=".draft__child__container__reader__title input";$(".header__actionsContainer__draft").click(()=>{smartHide(".draft","in")}),$(".draft__child__container__reader").submit(r=>{if(r.preventDefault(),data2send.table="drafts",""===a.val()&&invalid(a),""===e.val()&&invalid(e),""===_.val()&&invalid(_),validationErr){if(!$("drafts__child__container__reader .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".drafts__child__container__reader")}validationErr=!1}else $(".input").removeClass("invalid"),$("drafts__child__container__reader .warning").hide();data2send.values=[]}),$(".draft__child__container__reader__btnContainer__reset").click(()=>{smartHide(".draft","out"),$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]})};draftNewRequest();const inRequests=()=>{let e,_=$(".inRequests__form__docInfo__inv");socket.on("barcode",e=>{$("#inRequests__barcode__svg").length?($("#inRequests__barcode__svg").replaceWith(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")):($(".inRequests__barcode").append(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")),_.val(e.number)});let t,s,n=".inRequests__form__readerInfo__container__autocomplete",a=$(".inRequests__form__readerInfo__container__name"),i=$(".inRequests__form__readerInfo__mail"),o=$(".inRequests__form__pibInfo__pibNb"),r=$(".inRequests__form__pibInfo__borrowingLibrary"),d=$(".inRequests__form__pibInfo__requestDate"),l=$(".inRequests__form__pibInfo__loanLibrary"),u=$(".inRequests__form__docInfo__title"),m=$(".inRequests__form__docInfo__author"),v=$(".inRequests__form__docInfo__cdu"),f=$(".inRequests__form__pibInfo__outProvince").is(":checked"),c="",p="";a.keyup(()=>{socket.emit("retrieve readers",a.val())}),socket.on("readers retrieved",e=>{$(".inRequests__form__readerInfo__container__name").css({marginBottom:0,borderBottom:"2px solid transparent"}),$(".inRequests__form__readerInfo__container__name").ready(()=>{let e=$(".inRequests__form__readerInfo__container__name").position();$(n).css({left:e.left,top:e.top+$(".inRequests__form__readerInfo__container__name").outerHeight()+12,width:$(".inRequests__form__readerInfo__container__name").outerWidth()})}),$(n).empty().toggleClass("hidden flex");for(const _ of e)if(!$("."+_.name.match(/[^,\s]/gi).join("")).length){$("<p></p>").append(_.name).addClass(_.name.match(/[^,\s]/gi).join("")).appendTo(n).click((function(){$(".inRequests__form__readerInfo__container__name").val($(this).text()).removeAttr("style"),$(n).toggleClass("hidden flex").empty(),socket.emit("mail request",$(this).text()),socket.on("mail retrieved",e=>{$(".inRequests__form__readerInfo__mail").val(e.mail),c=e.gender[0]})}))}}),a.focusout(()=>{$(".inRequests__form__readerInfo__container__name").removeAttr("style",()=>{$(n).toggleClass("hidden flex").empty()})}),$(n).focusout((function(){$(this).toggleClass("hidden flex").empty()}));let q=$(".inRequests__form__docInfo__inv").val();$(".inRequests__form__btnContainer__submit").click(e=>{if(e.preventDefault(),data2send.table="in_requests",o.val().match(/\d{6}/)&&!o.val().match(/\d{7,}/)||invalid(o),""===r.val()&&invalid(r),""===d.val()&&invalid(d),""===l.val()&&invalid(l),""===a.val()&&invalid(a),""===i.val()&&invalid(i),""!==u.val()?t=u.val():invalid(u),""!==m.val()?s=m.val():invalid(m),""===v.val()&&invalid(v),""===_.val()&&invalid(_.val()),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1}else $(".input").removeClass("invalid"),$("form .warning").hide(),$("#inRequests__barcode__svg").clone().appendTo(".inRequests__step2__barcode"),$(".inRequests__step2__reminder__content__item__title").text(t),$(".inRequests__step2__reminder__content__item__author").text(s),$(".inRequests__step2__reminder__content__item__inv").text(q),$(".inRequests__step1").fadeOut(()=>{$(".inRequests__step1").removeAttr("style").toggleClass("hidden flex")}),$(".inRequests__step2").fadeIn().removeAttr("style").removeClass("translateXonwards translateXbackwards hidden").toggleClass("fixed flex");data2send.values=[]}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".inRequests__step3__confirmation").click(()=>{confirmation(),e=setTimeout(()=>{data2send.values.push(o.val()),data2send.values.push(r.val()),data2send.values.push(d.val()),data2send.values.push(l.val()),data2send.values.push(a.val()),data2send.email={send:!0,receiver:a.val()},data2send.values.push(u.val()),-1!==m.val().indexOf(",")?(p=m.val().split(","),data2send.values.push(p[0].toUpperCase().trim(),p[1].trim())):(p=m.val(),data2send.values.push(p),data2send.authorFirstName=!1),data2send.values.push(v.val()),data2send.values.push(f),data2send.values.push(_.val()),socket.emit("append data",data2send),data2send.values=[],$(".inRequests__step3").fadeOut(()=>{confirmation(),socket.emit("send mail",{name:a.val(),mail:i.val(),gender:c,request:$(".inRequests__form__docInfo__title").val()}),$(".inRequests__step2__barcode #inRequests__barcode__svg").remove(),$(".inRequests__form .input").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".inRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})},5e3)}),$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out",e)})};inRequests();const invalid=e=>{e.addClass("invalid"),validationErr=!0},outRequests=()=>{let e="",a=$(".outRequests__form__pibInfo__pibNb"),t=$(".outRequests__form__pibInfo__borrowingLibrary"),s=$(".outRequests__form__pibInfo__requestDate"),_=$(".outRequests__form__pibInfo__loanLibrary"),n=$(".outRequests__form__docInfo__title"),o=$(".outRequests__form__docInfo__author"),i=$(".outRequests__form__docInfo__cdu"),u=$(".outRequests__form__pibInfo__outProvince").is(":checked"),d="";$(".outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${month}-${day}`),$(".outRequests__form__btnContainer__submit").click(l=>{if(l.preventDefault(),data2send.table="out_requests",a.val().match(/\d{6}/)&&!a.val().match(/\d{7,}/)||invalid(a),""===t.val()&&invalid(t),""===s.val()&&invalid(s),""===_.val()&&invalid(_),""===n.val()&&invalid(n),""===o.val()&&invalid(o),""===i.val()&&invalid(i),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".outRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout(()=>{data2send.values.push(a.val()),data2send.values.push(t.val()),data2send.values.push(s.val()),data2send.values.push(_.val()),data2send.values.push(n.val()),-1!==o.val().indexOf(",")?(d=o.val().split(","),data2send.values.push(d[0].toUpperCase().trim(),d[1].trim())):(d=o.val(),data2send.values.push(d),data2send.authorFirstName=!1),data2send.values.push(i.val()),data2send.values.push(u),socket.emit("append data",data2send),data2send.values=[],$(".outRequests__step3").fadeOut((function(){confirmation(),$(this).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})),$(".outRequests__form .input").not(".outRequests__form__pibInfo__requestDate, .outRequests__form__pibInfo__loanLibrary").val("")},5e3)}),$(".outRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out",e)})};outRequests();const returnDocument=(e,t)=>{let n;$(t).click(()=>{confirmation(),n=setTimeout(()=>{$(e).fadeOut(()=>{confirmation(),$(e).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})},5e3)}),$(".confirmation__body__cancel").click(()=>{clearTimeout(n)})},sendDeletion=e=>{$(e+"__btn").click(t=>{t.preventDefault();let n="";n=".outReturns__step3"===e?"out_requests":"in_requests",console.log({table:n,data:$(e+"__input").val()}),socket.emit("delete data",{table:n,data:$(e+"__input").val()})})};returnDocument(".inReturns__step3",".inReturns__step3__confirmation"),returnDocument(".outReturns__step3",".outReturns__step3__confirmation"),sendDeletion(".outReturns__step3"),sendDeletion(".inReturns__step3");const search=()=>{let e={table:"",reader:"",title:"",getReader:!1,getTitle:!0};$(".search__container__select").on("change",(function(){"out_requests"===$(this).val()?$(".search__container__readerInput").attr("disabled",!0):$(".search__container__readerInput").attr("disabled",!1)})),$(".search__container").submit(a=>{a.preventDefault(),$(".search__results__container").empty((function(){$(this).fadeOut()})),("in_requests"===$(".search__container__select").val()||"out_requests"===$(".search__container__select").val())&&(e.table=$(".search__container__select").val()),""!==$(".search__container__readerInput").val()&&(e.getReader=!0,e.reader=$(".search__container__readerInput").val()),""!==$(".search__container__titleInput").val()&&(e.getTitle=!0,e.title=$(".search__container__titleInput").val()),socket.emit("search",e),e.table=e.reader=e.title="",e.getReader=e.getTitle=!1}),socket.on("search results",e=>{let a=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[_,r]of Object.keys(e[0]).entries()){let e=r;if("in_requests"===$(".search__container__select").val()?"borrowing_library"===r&&(e="PrÃªteur"):"out_requests"===$(".search__container__select").val()&&"borrowing_library"===r&&(e="Emprunteur"),"loan_library"!==r&&"book_author_firstname"!==r){switch(r){case"pib_number":e="NÂ° PIB";break;case"request_date":e="Date";break;case"book_title":e="Titre";break;case"book_author_name":e="Auteur";break;case"cdu":e="CDU";break;case"out_province":e="Hors Province ?";break;case"barcode":e="NÂ° inv."}$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(a)}}for(const[a,_]of e.entries()){let e=$("<span></span>").addClass("search__results__container__row flex").appendTo(".search__results__container");$("<span></span>").addClass("search__results__container__row__item").append(_.pib_number).appendTo(e),$("<span></span>").addClass("search__results__container__row__item").append(_.borrowing_library).appendTo(e),$("<span></span>").addClass("search__results__container__row__item").append(_.request_date.substring(0,10)).appendTo(e);if(void 0!==_.reader_name){$("<span></span>").addClass("search__results__container__row__item").append(_.reader_name).appendTo(e)}$("<span></span>").addClass("search__results__container__row__item").append(_.book_title).appendTo(e);let a=$("<span></span>").addClass("search__results__container__row__item");void 0!==_.book_author_firstname&&null!==_.book_author_firstname?a.append(`${_.book_author_name}, ${_.book_author_firstname}`):a.append(_.book_author_name),a.appendTo(e);$("<span></span>").addClass("search__results__container__row__item").append(_.cdu).appendTo(e);let r=$("<input>").addClass("search__results__container__row__item").attr("type","checkbox").attr("disabled",!0).appendTo(e);if(_.out_province?r.attr("checked",!0):r.attr("checked",!1),void 0!==_.barcode){$("<span></span>").addClass("search__results__container__row__item").append(_.barcode).appendTo(e)}}$(".search__results__container").fadeIn()})};search();