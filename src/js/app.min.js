const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header, .draft").toggleClass("blur"):$(".wrapper, .header, .draft").toggleClass("blur"),$(".wrapper *").removeClass("translateXbackwards")};$(".confirmation__body__cancel").click((()=>{smartHide(".confirmation","out")}));const handleHomeBtnClick=(e,t)=>{const _=e=>{$(".requestTypeChoice").addClass("hidden").removeClass("flex"),"outRequests"===e||"inRequests"===e?$(`.${e}__step1`).removeClass("hidden").addClass("flex"):"loan"===e&&$(".requestTypeChoice").hasClass("newRequest")?$(".inRequests__step1").removeClass("hidden").addClass("flex"):"borrowing"===e&&$(".requestTypeChoice").hasClass("newRequest")&&$(".outRequests__step1").removeClass("hidden").addClass("flex")};$(`.home__${t}__${e}`).click((()=>{"newRequest"===e?($(".requestTypeChoice").addClass(`${e} flex`).removeClass("hidden"),$(".requestTypeChoice__btnContainer__loan").click((()=>{$(".inRequests__form__pibInfo__outProvince").prop("checked",!1),_("loan")})),$(".requestTypeChoice__btnContainer__borrowing").click((()=>{_("borrowing")}))):"followRequest"===e?$(".inRequests__step3").removeClass("hidden").addClass("flex"):"outReturns"===e?$(".outReturns__step1").removeClass("hidden").addClass("flex"):"inReturns"===e&&$(".inReturns__step1").removeClass("hidden").addClass("flex"),$(".home").addClass("hidden").removeClass("flex"),$(".returnIcon, .header__container__msg").removeClass("hidden")}))};handleHomeBtnClick("newRequest","btnContainer"),handleHomeBtnClick("followRequest","btnContainer"),handleHomeBtnClick("inReturns","btnContainer"),handleHomeBtnClick("outReturns","btnContainer");const socket=io();let inRequestsReaderGender,barcodeOptions={format:"CODE39",lineColor:"#000000",displayValue:!0},data2send={table:"",values:[],authorFirstName:!0};const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;const handleSimpleStep=(e,t,_,a)=>{$(`${e}__${t}__${a}`).click((()=>{validationErr||($(`${e}__${t}`).toggleClass("translateXbackwards hidden flex"),".inRequests__step3"==`${e}__${t}`&&$(".inRequests__step4 input").val(""),$(`${e}__${_}`).removeClass("translateXonwards hidden").toggleClass("fixed flex"))}))};handleSimpleStep(".inRequests","step1","step2","confirmation"),handleSimpleStep(".inRequests","step3","step4","confirmation"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".outRequests","step3","step4","btn"),handleSimpleStep(".inReturns","step1","step2","btn"),handleSimpleStep(".inReturns","step2","step3","confirmation"),handleSimpleStep(".outReturns","step1","step2","btn"),handleSimpleStep(".outReturns","step2","step3","confirmation"),$(".returnIcon").click((()=>{const e=(e,t)=>{var _;e.match(/(step1|requestTypeChoice|inRequests__step3)/gi)?$(e).is(":visible")&&!e.match(/(inRequests__step1|inRequests__step2|outRequests)/gi)||"inRequests__step3"===e?(_=e,$(_).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").addClass("hidden").removeClass("flex"),setTimeout((()=>{$(_).toggleClass("translateXonwards flex")}),500),$(".requestTypeChoice").removeClass("newRequest")):$(e).is(":visible")&&e.match(/(inRequests|outRequests)/gi)&&"inRequests__step3"!==e&&($(e).removeClass("translateXbackwards translateXonwards flex").addClass("hidden"),$(".requestTypeChoice").hasClass("newRequest")&&$(".requestTypeChoice").addClass("flex").removeClass("hidden")):$(e).is(":visible")&&($(e).addClass("translateXonwards hidden").removeClass("flex"),$(t).removeClass("translateXbackwards hidden").addClass("flex"))};e(".inReturns__step1"),e(".outReturns__step1"),e(".addReader__step1"),e(".requestTypeChoice"),e(".inRequests__step3"),e(".outRequests__step1",".requestTypeChoice"),e(".inRequests__step1",".requestTypeChoice"),e(".outRequests__step2",".outRequests__step1"),e(".outRequests__step3",".outRequests__step2"),e(".outRequests__step4",".outRequests__step3"),e(".inRequests__step2",".inRequests__step1"),e(".inRequests__step4",".inRequests__step3"),e(".inReturns__step2",".inReturns__step1"),e(".inReturns__step3",".inReturns__step2"),e(".outReturns__step2",".outReturns__step1"),e(".outReturns__step3",".outReturns__step2")})),$(".menu__item").click((()=>{$(".header__menu__switch").prop("checked")&&$(".header__menu__switch").prop("checked",!1)}));const invalid=e=>{e.addClass("invalid"),validationErr=!0};socket.on("notification",(e=>{"success"===e.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationFailure").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===e.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationMail notificationSuccess").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")):"info"===e.type?($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").removeClass("notificationSuccess notificationMail notificationFailure").addClass("notificationInfo"),$(".notification__msg").text("Aucune donnÃ©e correspondante n'a Ã©tÃ© trouvÃ©e... ðŸ˜¶")):"mail"===e.type?($(".notification__icon").attr("src","./src/scss/icons/mail.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationMail"),$(".notification__msg").text("Mail envoyÃ© au lecteur ðŸ˜Ž")):"barcode"===e.type&&($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").removeClass("notificationInfo notificationSuccess notificationFailure").addClass("notificationFailure"),$(".notification__msg").text("Plus aucun code-barres n'est disponible... ðŸ˜¶"),$(".inRequests__barcode__svg").remove(),$(".inRequests__form__docInfo__inv").val("")),$(".notification").removeClass("hidden").addClass("flex"),setTimeout((()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo flex").addClass("hidden")}))}),5e3)}));const smartHide=(e,t,_)=>{"in"===t?($(e).toggleClass("hidden flex"),$(".wrapper, .header").addClass("blur")):($(e).toggleClass("hidden flex"),$(".inRequests").hasClass("absolute")?$(".header").toggleClass("blur"):$(".wrapper, .header").toggleClass("blur"),void 0!==_&&clearTimeout(_))},addReader=()=>{let e,t=$(".addReader__step1__form__nameContainer__readerName"),_=$(".addReader__step1__form__nameContainer__readerFirstName"),a=$(".addReader__step1__form__email__input"),s="";$(".addReader__step1__form__btnContainer__submit").click((n=>{if(n.preventDefault(),data2send.table="readers",$(".addReader__step1__form input.radio").each((function(){$(this).is(":checked")&&(s=$(this).val())})),""===t.val()&&invalid(t),""===_.val()&&invalid(_),a.is(":invalid")&&invalid(a),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addReader__step1__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout((function(){data2send.values.push(`${capitalizeFirstLetter(t.val())}, ${capitalizeFirstLetter(_.val())}`),""!==a.val()&&data2send.values.push(`mailto:${a.val()}`),data2send.values.push(s),socket.emit("append data",data2send),data2send.values=[],$(".addReader__step1").removeAttr("style").toggleClass("hidden flex"),confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),$(".addReader__step1 input").not(".radio").val("")}),5e3)})),$(".addReader__form__btnContainer__reset").click((()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]})),$(".confirmation__body__cancel").click((()=>{clearTimeout(e)}))};$(".addReaderLink").click((()=>{$(".home, .returnIcon, .header__container__msg, .addReader__step1").toggleClass("hidden flex"),addReader()}));const autocomplete=(e,t)=>{$(e).on("keydown",(function(){let e=$(this);socket.emit("retrieve readers",e.val()),""===e.val()&&($(t).empty().toggleClass("hidden flex"),e.removeAttr("style"))})),socket.on("readers retrieved",(_=>{_!==[]&&($(e).css({marginBottom:0,borderBottom:"2px solid transparent"}),$(e).ready((()=>{let _=$(e).position();$(t).css({left:_.left,top:_.top+$(e).outerHeight()+12,width:$(e).outerWidth()})})),$(t).empty().addClass("flex").removeClass("hidden"));for(const a of _){$("<p></p>").append(a.name).addClass(a.name.match(/[^,\s]/gi).join("")).appendTo(t).click((function(){$(e).val($(this).text()).removeAttr("style"),$(t).toggleClass("hidden flex").empty(),".inRequests__step4__container__reader"===e&&(socket.emit("mail request",$(this).text()),socket.on("mail retrieved",(e=>{$(".inRequests__step4__container__mail").val(e.mail),inRequestsReaderGender=e.gender[0]})))}))}})),$(e).on("focusout",(()=>{$(e).removeAttr("style",(()=>{$(t).toggleClass("hidden flex")}))})),$(t).focusout((function(){$(this).toggleClass("hidden flex")}))},setDate=()=>{$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`)},setDay=e=>e.getDate()<10?`0${e.getDate()}`:e.getDate(),setMonth=e=>e.getMonth()<9?`0${e.getMonth()+1}`:e.getMonth()+1;$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${setMonth(new Date)}-${setDay(new Date)}`);const exportDB=()=>{let e="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(e=$(this).val())})),socket.emit("export db",e),e=""};$(".exportsLink").click((()=>{smartHide(".export","in"),format=""})),$(".export .btn--submit").click((()=>{exportDB()})),$(".export .btn--reset").click((()=>{smartHide(".export","out")})),socket.on("export successfull",(()=>{smartHide(".export","out"),window.open("/download")}));const draftNewRequest=()=>{let e,t=".draft__child__container__reader__name input",_=".draft__child__container__reader__date input",a=".draft__child__container__reader__bookTitle input",s=$(".draft__child__container__comment__textarea");$(".draftsLink").click((()=>{$(".draft__child__container input[type=text], .draft__child__container textarea").val(""),smartHide(".draft","in")})),autocomplete(".draft__child__container__reader__name input",".draft__child__container__reader__label__autocomplete"),$(".draft__child__container__reader").submit((n=>{if(n.preventDefault(),data2send.table="drafts",""===$(t).val()&&invalid($(t)),""===$(_).val()&&invalid($(_)),""===$(a).val()&&invalid($(a)),validationErr){if(!$(".draft__child__container__reader .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".draft__child__container__reader")}validationErr=!1}else $(".input").removeClass("invalid"),$(".draft__child__container__reader .warning").remove(),confirmation(),$(t).val($(t).val().replace(/'/g,"''")),$(a).val($(a).val().replace(/'/g,"''")),s.val(s.val().replace(/'/g,"''")),e=setTimeout((()=>{data2send.values.push($(t).val()),data2send.values.push(new Date($(_).val()).toUTCString()),data2send.values.push($(a).val()),""!==s.val()?data2send.values.push(s.val()):data2send.values.push("/"),socket.emit("append data",data2send),data2send.values=[],smartHide(".draft","out"),confirmation(),$(".draft__child__container .input, .draft__child__container textarea").not(".draft__child__container__reader__date input").val("")}),5e3);data2send.values=[]})),$(".draft__child__container__reader__btnContainer__reset").click((()=>{$(".draft").toggleClass("hidden flex"),$(".wrapper, .header").removeClass("blur"),$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]})),$(".confirmation__body__cancel").click((()=>{clearTimeout(e),$(".draft").removeClass("blur")}))};let initialPibNb,initialBarcode;draftNewRequest();const inRequests=()=>{let e,t=$(".inRequests__form__docInfo__inv");autocomplete(".inRequests__form__readerInfo__container__name",".inRequests__form__readerInfo__container__autocomplete"),autocomplete(".inRequests__step4__container__reader",".inRequests__step4__container__autocomplete"),socket.on("barcode",(e=>{initialBarcode=e,t.val(e),JsBarcode(".inRequests__barcode__svg",e,barcodeOptions)}));let _=$(".inRequests__form__readerInfo__container__name"),a=$(".inRequests__form__pibInfo__pibNb"),s=$(".inRequests__form__pibInfo__borrowingLibrary"),n=$(".inRequests__form__pibInfo__requestDate"),i=$(".inRequests__form__pibInfo__loanLibrary"),r=$(".inRequests__form__docInfo__title"),o=$(".inRequests__form__docInfo__author"),l=$(".inRequests__form__docInfo__cdu"),c=$(".inRequests__notes"),d="";$(".inRequests__form__docInfo__inv").on("input",(function(){$(this).val().length<14?($(this).addClass("invalid"),validationErr=!0):14===$(this).val().length&&$(this).val()!==initialBarcode?$(".inRequests").hasClass("absolute")?socket.emit("barcode verification",{code:$(this).val(),pib_number:initialPibNb}):""!==a.val()&&socket.emit("barcode verification",{code:$(this).val(),pib_number:a.val()}):$(this).val()===initialBarcode&&($(this).removeClass("invalid"),validationErr=!1,$("form .warning").remove(),JsBarcode(".inRequests__barcode__svg",initialBarcode,barcodeOptions))})),socket.on("barcode verified",(e=>{if("used"!==e||e===initialBarcode)$(this).removeClass("invalid"),validationErr=!1,$("form .warning").remove(),JsBarcode(".inRequests__barcode__svg",e,barcodeOptions);else if(validationErr=!0,!$("form .warning").length){$("<span></span>").addClass("warning").text("Ce code-barres est dÃ©jÃ  pris ou n'existe pas...").appendTo(".inRequests__form")}})),$(".inRequests__form").submit((u=>{if(u.preventDefault(),data2send.table="in_requests",data2send.sendNotes=!1,a.val().match(/\d{6}/)&&!a.val().match(/\d{7,}/)||invalid(a),""===s.val()&&invalid(s),""===n.val()&&invalid(n),""===i.val()&&invalid(i),""===_.val()&&invalid(_),""===r.val()&&invalid(r),""!==o.val()?-1!==o.val().indexOf(",")?(d=o.val().split(","),d=`${d[0].toUpperCase().trim()}, ${d[1].trim()}`):d=o.val():invalid(o),""===l.val()&&invalid(l),""===t.val()||14!==t.val().length?invalid(t):$(".inRequests").hasClass("absolute")?socket.emit("barcode verification",{code:t.val(),pib_number:initialPibNb}):""!==a.val()&&socket.emit("barcode verification",{code:t.val(),pib_number:a.val()}),""!==$(".inRequests__notes").val()&&(data2send.sendNotes=!0),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1,data2send.values=[]}else{$(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),$(".inRequests").hasClass("absolute")||$(".inRequests__step2").removeClass("translateXonwards translateXbackwards hidden fixed").addClass("flex");let o=$(".inRequests__form__pibInfo__outProvince").is(":checked");s.val(s.val().replace(/'/g,"''")),i.val(i.val().replace(/'/g,"''")),_.val(_.val().replace(/'/g,"''")),r.val(r.val().replace(/'/g,"''")),data2send.sendNotes&&c.val(c.val().replace(/'/g,"''")),e=setTimeout((()=>{data2send.values.push(a.val()),data2send.values.push(s.val()),data2send.values.push(new Date(n.val()).toUTCString()),data2send.values.push(i.val()),data2send.values.push(_.val()),data2send.values.push(r.val()),-1===d.indexOf(",")?(data2send.authorFirstName=!1,data2send.values.push(d)):(d=d.split(","),d[0]=d[0].replace(/'/g,"''"),data2send.values.push(d[0].trim(),d[1].trim())),data2send.values.push(l.val()),data2send.values.push(o),data2send.values.push(t.val()),data2send.sendNotes&&data2send.values.push(c.val()),$(".inRequests").hasClass("absolute")?(data2send.key=initialPibNb,data2send.barcode=initialBarcode,$(".inRequests.absolute").toggleClass("hidden flex"),$(".wrapper").toggleClass("backgroundColor blur"),socket.emit("update",data2send),$(".inRequests.absolute .inRequests__form__btnContainer__hide").toggleClass("hidden")):(socket.emit("append data",data2send),$(".inRequests__step2").toggleClass("hidden flex"),$(".inRequests__step2__barcode .inRequests__barcode__svg").remove(),$(".inRequests__form .input, .inRequests__notes").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")),confirmation(),data2send.values=[]}),5e3)}})),$(".inRequests__form__btnContainer__reset").click((()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]})),$(".inRequests__step4__container").submit((t=>{t.preventDefault();let _=$(".inRequests__step4__container__reader"),a=$(".inRequests__step4__container__title"),s=$(".inRequests__step4__container__mail");if(""===_.val()&&invalid(_),""===a.val()&&invalid(a),""===s.val()&&invalid(s),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__step4__container")}validationErr=!1}else confirmation(),e=setTimeout((()=>{confirmation(),$(".inRequests__step4").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),setTimeout((()=>{socket.emit("send mail",{name:$(".inRequests__step4__container__reader").val(),mail:$(".inRequests__step4__container__mail").val(),gender:inRequestsReaderGender,request:$(".inRequests__step4__container__title").val()})}),1e3)}),5e3)})),$(".confirmation__body__cancel").click((()=>{clearTimeout(e)}))};inRequests(),$(".leaveLink").click((()=>{$(".wrapper, header").toggleClass("blur"),$(".leave").toggleClass("hidden flex"),$(".leave").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))})),$(".shutdownBtn").click((()=>{socket.emit("shutdown")})),$(".restartBtn").click((()=>{socket.emit("restart"),setTimeout((()=>{location.reload()}),1e4)}))}));const returnDocument=(e,t)=>{let _;$(t).click((()=>{confirmation(),_=setTimeout((()=>{$(e).toggleClass("hidden flex"),confirmation(),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")}),5e3)})),$(".confirmation__body__cancel").click((()=>{clearTimeout(_)}))},sendDeletion=e=>{$(`${e}__btn`).click((t=>{t.preventDefault();let _="";_=".outReturns__step3"===e?"out_requests":"in_requests",socket.emit("delete data",{table:_,data:$(`${e}__input`).val()})}))};returnDocument(".inReturns__step3",".inReturns__step3__confirmation"),returnDocument(".outReturns__step3",".outReturns__step3__confirmation"),sendDeletion(".outReturns__step3"),sendDeletion(".inReturns__step3");const search=()=>{let e,t,_={},a={table:"",reader:"",title:"",getReader:!1,getTitle:!0};const s={"''":"'","\n":"<br>","<br>":"\n"},n=(e,t,_,a)=>{let s=document.querySelector(`.${t} ${_}`);s.select(),s.setSelectionRange(0,99999),document.execCommand("copy");let n=e.attr("class").split(" ");setTimeout((()=>{$(`.${n[1]} p`).text(a)}),1500)};$(".search__container__select").on("change",(function(){"out_requests"===$(this).val()?($(".search__container__readerInput").attr("disabled",!0),$(".search__container__titleInput").attr("disabled",!1)):"in_requests"===$(this).val()||"drafts"===$(this).val()?$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!1):"default"===$(this).val()&&$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!0)})),$(".search__container").submit((e=>{e.preventDefault(),a.getReader=a.getTitle=!1,"default"!==$(".search__container__select").val()&&(a.table=$(".search__container__select").val(),""!==$(".search__container__readerInput").val()&&(a.getReader=!0,a.reader=$(".search__container__readerInput").val().replace(/\'/g,"''")),""!==$(".search__container__titleInput").val()&&(a.getTitle=!0,a.title=$(".search__container__titleInput").val().replace(/\'/g,"''")),socket.emit("search",a),a.table=a.reader=a.title="",a.getReader=a.getTitle=!1)})),socket.on("search results",(a=>{let i;if(console.log(a[0]),a.length<=1?$(".search__title__h2").text(`${a.length} rÃ©sultat de recherche`):$(".search__title__h2").text(`${a.length} rÃ©sultats de recherche`),$(".search__results__container").empty((function(){$(this).fadeOut()})),void 0!==a[0]){let r=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[e,t]of Object.keys(a[0]).entries()){let e=t;if("in_requests"===$(".search__container__select").val()?"borrowing_library"===t&&(e="PrÃªteur"):"out_requests"===$(".search__container__select").val()&&"borrowing_library"===t&&(e="Emprunteur"),"loan_library"!==t&&"book_author_firstname"!==t){switch(t){case"pib_number":e="NÂ° PIB";break;case"request_date":e="Date";break;case"book_title":e="Titre";break;case"book_author_name":e="Auteur";break;case"cdu":e="CDU";break;case"out_province":e="Hors Province ?";break;case"barcode":e="NÂ° inv.";break;case"id":e="NÂ° de demande";break;case"comment":e="Commentaires";break;case"reader_name":e="Lecteur";break;case"notes":e="Notes"}$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(r)}}for(const[e,t]of a.entries()){let _=$("<span></span>").addClass(`search__results__container__row search__results__container__row--${e} flex`).appendTo(".search__results__container");if(void 0!==t.id){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--id").append(t.id).appendTo(_)}if(void 0!==t.pib_number){$("<input>").addClass("search__results__container__row__item rowItem search__results__container__row__item--pib noInput").val(t.pib_number).appendTo(_)}if(void 0!==t.borrowing_library){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--borrowing_library").append(t.borrowing_library.replace(/\'\'/g,"'")).appendTo(_)}let a=$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--date"),n=$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--timestamp hidden");if(null!==t.request_date?(a.append(new Date(t.request_date).toLocaleDateString()),n.append(t.request_date.split("T")[0])):a.append("ProblÃ¨me d'affichage..."),n.appendTo(_),a.appendTo(_),void 0!==t.reader_name){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--reader").append(t.reader_name.replace(/\'\'/g,"'")).appendTo(_)}$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--title").append(t.book_title.replace(/\'\'/g,"'")).appendTo(_);let i=$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--author");if(void 0===t.book_author_name&&void 0===t.book_author_firstname||(void 0!==t.book_author_firstname&&null!==t.book_author_firstname?i.append(`${t.book_author_name.replace(/\'\'/g,"'")}, ${t.book_author_firstname}`):i.append(t.book_author_name.replace(/\'\'/g,"'")),i.appendTo(_)),void 0!==t.cdu){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--cdu").append(t.cdu).appendTo(_)}let r=$('      <svg xmlns="http://www.w3.org/2000/svg">        <circle cx="50%" cy="50%" r="5"/>      </svg>      ').addClass("search__results__container__row__item rowItem search__results__container__row__item--op flex");if(void 0!==t.out_province&&(r.attr("viewBox","0 0 75 10").appendTo(_),t.out_province?r.removeClass("unchecked").addClass("checked"):r.removeClass("checked").addClass("unchecked")),void 0!==t.barcode){$("<input>").addClass("search__results__container__row__item rowItem search__results__container__row__item--code noInput").val(t.barcode).appendTo(_)}if(void 0!==t.notes&&null!==t.notes){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--notes").append(t.notes.replace(/\'\'|\n/g,(e=>s[e]))).appendTo(_)}else{$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--notes").append("/").appendTo(_)}if(void 0!==t.comment){$("<span></span>").addClass("search__results__container__row__item rowItem search__results__container__row__item--comment").append(t.comment.replace(/\'\'|\n/g,(e=>s[e]))).appendTo(_)}}$(".search__results__container").fadeIn(),$(".search__results__container__row").contextmenu((function(e){$(".context").css({left:`${e.pageX}px`,top:`${e.pageY}px`}).toggleClass("hidden flex"),i=$(this).attr("class").split(" ")[1],"drafts"===$(".search__container__select").val()?($(".context__list__item--pib, .context__list__item--inv").addClass("hidden").removeClass("flex"),$(".context__list__item--del").addClass("context__list__item--bottom")):"out_requests"===$(".search__container__select").val()?$(".context__list__item--modify, .context__list__item--inv").addClass("hidden").removeClass("flex"):($(".context__list__item--pib, .context__list__item--inv, .context__list__item--modify").addClass("flex").removeClass("hidden"),$(".context__list__item--del").removeClass("context__list__item--bottom")),e.preventDefault(),$(".search__results, .search__results *").click((function(e){e.target===this&&$(".context").removeClass("flex").addClass("hidden")}))})),$(".context__list__item").click((()=>{$(".context").removeClass("flex").addClass("hidden")})),$(".context__list__item--modify").click((function(){let e=$(`.${i} .search__results__container__row__item--timestamp`).text();$(".wrapper").addClass("blur"),"drafts"===$(".search__container__select").val()?($(".draft__child__container__reader__date input").val(e),$(".draft__child__container__reader__name input").val($(`.${i} .search__results__container__row__item--reader`).text()),void 0!==$(`.${i} .search__results__container__row__item--comment`)?$(".draft__child__container__comment__textarea").val($(`.${i} .search__results__container__row__item--comment`).html().replace(/(<|&lt;)br(>|&gt;)/gi,"\n")):location.reload(),$(".draft__child__container__reader__bookTitle input").val($(`.${i} .search__results__container__row__item--title`).text()),$(".draft").removeClass("hidden").addClass("flex"),$(".draft__child__container__reader__btnContainer__submit").click((function(){t=setTimeout((function(){_={table:$(".search__container__select").val(),id:$(`.${i} .search__results__container__row__item--id`).text(),date:new Date($(".draft__child__container__reader__date input").val()).toUTCString(),reader:$(".draft__child__container__reader__name input").val().replace(/\'/g,"''"),comment:$(".draft__child__container__comment__textarea").val().replace(/\'/g,"''"),title:$(".draft__child__container__reader__bookTitle input").val().replace(/\'/g,"''")};let e=_.comment.trim().split("\n");$(e).each(((t,_)=>{""===_&&e.splice(t,1,$("<br>")[0])})),$(`.${i} .search__results__container__row__item--date`).text(new Date(_.date).toLocaleDateString()),$(`.${i} .search__results__container__row__item--reader`).text(_.reader.replace(/\'\'/g,"'")),$(`.${i} .search__results__container__row__item--comment`).text(e.join("").replace(/\'\'/g,"'")),$(`.${i} .search__results__container__row__item--title`).text(_.title.replace(/\'\'/g,"'")),socket.emit("update",_)}),5e3),$(".confirmation__body__cancel").click((()=>{$(".draft").removeClass("blur"),clearTimeout(t),t=void 0}))}))):"in_requests"===$(".search__container__select").val()&&($(".inRequests").addClass("absolute flex").removeClass("hidden"),initialPibNb=$(`.${i} .search__results__container__row__item--pib`).val(),initialBarcode=$(`.${i} .search__results__container__row__item--code`).val(),$(".inRequests.absolute .inRequests__form__btnContainer__hide").removeClass("hidden"),$(".inRequests.absolute .inRequests__form__pibInfo__pibNb").val($(`.${i} .search__results__container__row__item--pib`).val()),$(".inRequests.absolute .inRequests__form__pibInfo__borrowingLibrary").val($(`.${i} .search__results__container__row__item--borrowing_library`).text()),$(".inRequests.absolute .inRequests__form__pibInfo__requestDate").val(e),$(".inRequests.absolute .inRequests__form__readerInfo__container__name").val($(`.${i} .search__results__container__row__item--reader`).text()),$(".inRequests.absolute .inRequests__form__docInfo__title").val($(`.${i} .search__results__container__row__item--title`).text()),$(".inRequests.absolute .inRequests__form__docInfo__author").val($(`.${i} .search__results__container__row__item--author`).text()),$(".inRequests.absolute .inRequests__form__docInfo__cdu").val($(`.${i} .search__results__container__row__item--cdu`).text()),$(".inRequests.absolute .inRequests__form__docInfo__inv").val($(`.${i} .search__results__container__row__item--code`).val()),$(".inRequests.absolute .inRequests__notes").val($(`.${i} .search__results__container__row__item--notes`).html().replace(/\'\'|<br>/g,(e=>s[e]))),$(`.${i} .search__results__container__row__item--op`).hasClass("checked")?$(".inRequests.absolute .inRequests__form__pibInfo__outProvince").prop("checked",!0):$(".inRequests.absolute .inRequests__form__pibInfo__outProvince").prop("checked",!1),JsBarcode(".inRequests.absolute .inRequests__barcode__svg",$(".inRequests.absolute .inRequests__form__docInfo__inv").val(),barcodeOptions),$(".inRequests.absolute .inRequests__form__btnContainer__submit").click((()=>{$(`.${i} .search__results__container__row__item--pib`).val($(".inRequests__form__pibInfo__pibNb").val()),$(`.${i} .search__results__container__row__item--borrowing_library`).text($(".inRequests__form__pibInfo__borrowingLibrary").val()),$(`.${i} .search__results__container__row__item--date`).text(new Date($(".inRequests__form__pibInfo__requestDate").val()).toLocaleDateString()),$(`.${i} .search__results__container__row__item--reader`).text($(".inRequests__form__readerInfo__container__name").val()),$(`.${i} .search__results__container__row__item--title`).text($(".inRequests__form__docInfo__title").val()),$(`.${i} .search__results__container__row__item--author`).text($(".inRequests__form__docInfo__author").val()),$(`.${i} .search__results__container__row__item--cdu`).text($(".inRequests__form__docInfo__cdu").val()),$(`.${i} .search__results__container__row__item--code`).val($(".inRequests__form__docInfo__inv").val()),$(`.${i} .search__results__container__row__item--notes`).html($(".inRequests__notes").val().replace(/\n/g,"<br>")),$(".inRequests__form__pibInfo__outProvince").is(":checked")?$(`.${i} .search__results__container__row__item--op`).removeClass("unchecked").addClass("checked"):$(`.${i} .search__results__container__row__item--op`).removeClass("checked").addClass("unchecked")})),$(".inRequests.absolute .inRequests__form__btnContainer__hide").click((function(){$(".inRequests").removeClass("absolute flex").addClass("hidden"),$(".wrapper").removeClass("blur backgroundColor"),$(this).addClass("hidden")})))})),$(".context__list__item--del").click((function(){let t={};confirmation(),"drafts"===$(".search__container__select").val()?t={table:"drafts",key:$(`.${i} .search__results__container__row__item--id`).text()}:"in_requests"===$(".search__container__select").val()?t={table:"in_requests",key:$(`.${i} .search__results__container__row__item--pib`).val(),code:$(`.${i} .search__results__container__row__item--code`).val()}:"out_requests"===$(".search__container__select").val()&&(t={table:"out_requests",key:$(`.${i} .search__results__container__row__item--pib`).val()}),$(`.${i}`).toggleClass("hidden flex"),e=setTimeout((()=>{""!==t.table&&""!==t.key&&($(`.${i}`).remove(),confirmation(),socket.emit("delete data",t),t={})}),5e3),$(".confirmation__body__cancel").click((()=>{clearTimeout(e),$(`.${i}`).removeClass("hidden").addClass("flex"),e=void 0,t={}}))})),$(".context__list__item--inv").click((function(){n($(this),i,".search__results__container__row__item--code","Copier le nÂ° d'inventaire")})),$(".context__list__item--pib").click((function(){n($(this),i,".search__results__container__row__item--pib","Copier le nÂ° PIB")}))}}))};search();const settings=()=>{let e="",t="",_={};socket.on("settings",(_=>{e=_.mail_content.replace(/\'\'/g,"'"),t=_.library.replace(/\'\'/g,"'"),$(".settings__child__textarea__content").val(e),$(".settings__child__libraryContainer__label__input").val(t)})),$(".settingsLink").click((()=>{$(".settings__container").toggleClass("hidden flex"),$(".wrapper").addClass("blur")})),$(".settings__container").click((function(a){a.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper").removeClass("blur"),e!==$(".settings__child__textarea__content").val()&&(_.mail_content=$(".settings__child__textarea__content").val().replace(/\'/g,"''")),t!==$(".settings__child__libraryContainer__label__input").val()&&(_.library=$(".settings__child__libraryContainer__label__input").val().replace(/\'/g,"''")),socket.emit("settings",_))}))};settings();const showAbout=()=>{$(".aboutLink").click((()=>{$(".wrapper, header").toggleClass("blur"),$(".about__container").toggleClass("hidden flex")})),$(".updateBtn").click((()=>{socket.emit("update check")})),socket.on("update progress",(e=>{$(".updateBtn").text(e)})),$(".about__container").click((function(e){e.target===this&&($(this).toggleClass("hidden flex"),$(".wrapper, header").removeClass("blur"))}))};showAbout();