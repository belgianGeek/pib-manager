const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".wrapper, .header, .draft").toggleClass("blur"),$(".wrapper *").removeClass("translateXbackwards")};const handleHomeBtnClick=(e,n)=>{$(`.home__${n}__${e}`).click(()=>{$(".home").fadeOut(()=>{$(`.${e}__step1`).fadeIn(()=>{$(`.${e}__step1`).toggleClass("hidden flex").removeAttr("style")}),setTimeout(()=>{$(".home").toggleClass("flex hidden").removeAttr("style"),$(".returnIcon, .header__container__msg").removeClass("hidden")},1e3)})})};handleHomeBtnClick("outRequests","btnContainer"),handleHomeBtnClick("inRequests","btnContainer"),handleHomeBtnClick("inReturns","btnContainer"),handleHomeBtnClick("outReturns","btnContainer"),handleHomeBtnClick("addReader","optionsContainer");const socket=io();let data2send={table:"",values:[],authorFirstName:!0};const capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1);let validationErr=!1;const handleSimpleStep=(e,t,s,n)=>{$(`${e}__${t}__${n}`).click(()=>{validationErr||($(`${e}__${t}`).toggleClass("translateXbackwards hidden flex"),setTimeout(()=>{$(`${e}__${s}`).fadeIn().removeAttr("style").removeClass("translateXonwards hidden").toggleClass("fixed flex")},1e3))})};handleSimpleStep(".inRequests","step2","step3","btn"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".inReturns","step1","step2","btn"),handleSimpleStep(".inReturns","step2","step3","confirmation"),handleSimpleStep(".outReturns","step1","step2","btn"),handleSimpleStep(".outReturns","step2","step3","confirmation"),$(".returnIcon").click(()=>{const e=(e,t)=>{var s;e.match("step1")?$(e).is(":visible")&&(s=e,$(s).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__container__msg").toggleClass("hidden"),setTimeout(()=>{$(s).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).toggleClass("translateXonwards flex hidden"),$(t).removeClass("translateXbackwards").toggleClass("hidden flex"))};e(".outRequests__step1"),e(".inRequests__step1"),e(".inReturns__step1"),e(".outReturns__step1"),e(".addReader__step1"),e(".outRequests__step2",".outRequests__step1"),e(".outRequests__step3",".outRequests__step2"),e(".inRequests__step2",".inRequests__step1"),e(".inRequests__step3",".inRequests__step2"),e(".inReturns__step2",".inReturns__step1"),e(".inReturns__step3",".inReturns__step2"),e(".outReturns__step2",".outReturns__step1"),e(".outReturns__step3",".outReturns__step2")});const invalid=i=>{i.addClass("invalid"),validationErr=!0,console.log(i+" is invalid !",validationErr)};socket.on("notification",i=>{"success"===i.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===i.type?($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")):"info"===i.type&&($(".notification__icon").attr("src","./src/scss/icons/info.svg"),$(".notification").addClass("notificationInfo"),$(".notification__msg").text("Aucune donnÃ©e correspondante n'a Ã©tÃ© trouvÃ©e... ðŸ˜¶")),$(".notification").toggleClass("hidden flex"),setTimeout(()=>{$(".notification").fadeOut((function(){$(this).removeAttr("style").removeClass("notificationSuccess notificationFailure notificationInfo").toggleClass("flex hidden")}))},5e3)});const smartHide=(e,r,s)=>{"in"===r?$(e).fadeIn((function(){$(this).addClass("flex").removeClass("hidden").removeAttr("style"),$(".wrapper, .header").removeClass("blur")})):$(e).fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),void 0!==s&&clearTimeout(s)}))};const addReader=()=>{let e="",a=$(".addReader__step1__form__nameContainer__readerName"),d=$(".addReader__step1__form__nameContainer__readerFirstName"),t=$(".addReader__step1__form__email__input"),n="";$(".addReader__step1__form__btnContainer__submit").click(i=>{if(i.preventDefault(),data2send.table="readers",$(".addReader__step1__form input.radio").each((function(){$(this).is(":checked")&&(n=$(this).val())})),""===a.val()&&invalid(a),""===d.val()&&invalid(d),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".addReader__step1__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout((function(){data2send.values.push(`${capitalizeFirstLetter(a.val())}, ${capitalizeFirstLetter(d.val())}`),""!==t.val()&&data2send.values.push("mailto:"+t.val()),data2send.values.push(n),socket.emit("append data",data2send),data2send.values=[],$(".addReader__step1").fadeOut((function(){confirmation(),$(this).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden"),$(".addReader__step1 input").not(".radio").val("")}))}),5e3)}),$(".addReader__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(e)}))})};addReader();const autocomplete=(e,t)=>{$(e).keyup(()=>{socket.emit("retrieve readers",$(e).val())}),socket.on("readers retrieved",o=>{$(e).css({marginBottom:0,borderBottom:"2px solid transparent"}),$(e).ready(()=>{let o=$(e).position();$(t).css({left:o.left,top:o.top+$(e).outerHeight()+12,width:$(e).outerWidth()})}),$(t).empty().toggleClass("hidden flex");for(const s of o)if(!$("."+s.name.match(/[^,\s]/gi).join("")).length){$("<p></p>").append(s.name).addClass(s.name.match(/[^,\s]/gi).join("")).appendTo(t).click((function(){$(e).val($(this).text()).removeAttr("style"),$(t).toggleClass("hidden flex").empty(),".inRequests__form__readerInfo__container__name"===e&&(socket.emit("mail request",$(this).text()),socket.on("mail retrieved",e=>{$(".inRequests__form__readerInfo__mail").val(e.mail),gender=e.gender[0]}))}))}}),$(e).focusout(()=>{$(e).removeAttr("style",()=>{$(t).toggleClass("hidden flex").empty()})}),$(t).focusout((function(){$(this).toggleClass("hidden flex").empty()}))};const setDate=()=>{let e,t;e=(new Date).getDate()<"10"?"0"+(new Date).getDate():(new Date).getDate(),t=(new Date).getMonth()<"10"?"0"+((new Date).getMonth()+1):(new Date).getMonth()+1,$(".inRequests__form__pibInfo__requestDate,.draft__child__container__reader__date input,.outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${t}-${e}`)};setDate();const exportDB=()=>{let t="";$(".export__child__container__format input.radio").each((function(){$(this).is(":checked")&&(t=$(this).val())})),socket.emit("export db",t),t=""};$(".header__actionsContainer__importExport").click(()=>{smartHide(".export","in"),$(".export .btn--submit").click(()=>{exportDB()}),$(".export .btn--reset").click(()=>{smartHide(".export","out")}),format=""}),socket.on("export successfull",()=>{$.ajax({method:"GET",url:"/zip"})});const draftNewRequest=()=>{let a=".draft__child__container__reader__name input",e=".draft__child__container__reader__date input",t=".draft__child__container__reader__bookTitle input",_=$(".draft__child__container__comment__textarea"),n="";$(".header__actionsContainer__draft").click(()=>{smartHide(".draft","in")}),autocomplete(".draft__child__container__reader__name input",".draft__child__container__reader__label__autocomplete"),$(".draft__child__container__reader").submit(d=>{if(d.preventDefault(),data2send.table="drafts",""===$(a).val()&&invalid($(a)),""===$(e).val()&&invalid($(e)),""===$(t).val()&&invalid($(t)),validationErr){if(!$("drafts__child__container__reader .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".drafts__child__container__reader")}validationErr=!1}else $(".input").removeClass("invalid"),$("drafts__child__container__reader .warning").hide(),confirmation(),n=setTimeout(()=>{data2send.values.push($(a).val()),data2send.values.push(new Date($(e).val()).toUTCString()),data2send.values.push($(t).val()),""!==_.val()?data2send.values.push(_.val()):data2send.values.push("/"),socket.emit("append data",data2send),data2send.values=[],$(".draft").fadeOut(()=>{confirmation(),$(".draft__child__container .input, .draft__child__container textarea").not(".draft__child__container__reader__date input").val(""),$(".draft").removeAttr("style").toggleClass("hidden flex")})},5e3);data2send.values=[]}),$(".draft__child__container__reader__btnContainer__reset").click(()=>{smartHide(".draft","out"),$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{confirmation(),smartHide(".confirmation","out",n)})};draftNewRequest();const inRequests=()=>{let e,_=$(".inRequests__form__docInfo__inv");autocomplete(".inRequests__form__readerInfo__container__name",".inRequests__form__readerInfo__container__autocomplete"),socket.on("barcode",e=>{_.val(e),JsBarcode(".inRequests__barcode__svg",e,{format:"CODE39",lineColor:"#000000",displayValue:!0})});let s,a,t=$(".inRequests__form__readerInfo__container__name"),n=$(".inRequests__form__readerInfo__mail"),i=$(".inRequests__form__pibInfo__pibNb"),o=$(".inRequests__form__pibInfo__borrowingLibrary"),r=$(".inRequests__form__pibInfo__requestDate"),l=$(".inRequests__form__pibInfo__loanLibrary"),d=$(".inRequests__form__docInfo__title"),u=$(".inRequests__form__docInfo__author"),v=$(".inRequests__form__docInfo__cdu"),m=$(".inRequests__form__pibInfo__outProvince").is(":checked"),f="",c=_.val();$(".inRequests__form__btnContainer__submit").click(e=>{if(e.preventDefault(),data2send.table="in_requests",i.val().match(/\d{6}/)&&!i.val().match(/\d{7,}/)||invalid(i),""===o.val()&&invalid(o),""===r.val()&&invalid(r),""===l.val()&&invalid(l),""===t.val()&&invalid(t),""===n.val()&&invalid(n),""!==d.val()?s=d.val():invalid(d),""!==u.val()?(-1!==u.val().indexOf(",")?(f=u.val().split(","),f=`${f[0].toUpperCase().trim()}, ${f[1].trim()}`):f=u.val(),a=f):invalid(u),""===v.val()&&invalid(v),""===_.val()&&invalid(_.val()),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1}else{$(".input").removeClass("invalid"),$("form .warning").hide();let e=$(".inRequests__barcode__svg").clone();0===$(".inRequests__step2__barcode svg").length?e.appendTo(".inRequests__step2__barcode"):$(".inRequests__step2__barcode svg").replaceWith(e),$(".inRequests__step2__reminder__content__item__title").text(s),$(".inRequests__step2__reminder__content__item__author").text(a),$(".inRequests__step2__reminder__content__item__inv").text(c),$(".inRequests__step1").fadeOut(()=>{$(".inRequests__step1").removeAttr("style").toggleClass("hidden flex")}),$(".inRequests__step2").fadeIn().removeAttr("style").removeClass("translateXonwards translateXbackwards hidden").toggleClass("fixed flex")}data2send.values=[]}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".inRequests__step3__confirmation").click(()=>{confirmation(),e=setTimeout(()=>{data2send.values.push(i.val()),data2send.values.push(o.val()),data2send.values.push(new Date(r.val()).toUTCString()),data2send.values.push(l.val()),data2send.values.push(t.val()),data2send.email={send:!0,receiver:t.val()},data2send.values.push(d.val()),-1===f.indexOf(",")?(data2send.authorFirstName=!1,data2send.values.push(f)):(f=f.split(","),data2send.values.push(f[0].trim(),f[1].trim())),data2send.values.push(v.val()),data2send.values.push(m),data2send.values.push(_.val()),socket.emit("append data",data2send),data2send.values=[],$(".inRequests__step3").fadeOut(()=>{confirmation(),socket.emit("send mail",{name:t.val(),mail:n.val(),gender:"",request:$(".inRequests__form__docInfo__title").val()}),$(".inRequests__step2__barcode .inRequests__barcode__svg").remove(),$(".inRequests__form .input").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".inRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})},5e3)}),$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out",e)})};inRequests();const outRequests=()=>{let e="",a=$(".outRequests__form__pibInfo__pibNb"),t=$(".outRequests__form__pibInfo__borrowingLibrary"),s=$(".outRequests__form__pibInfo__requestDate"),n=$(".outRequests__form__pibInfo__loanLibrary"),o=$(".outRequests__form__docInfo__title"),_=$(".outRequests__form__docInfo__author"),i=$(".outRequests__form__docInfo__cdu"),u=$(".outRequests__form__pibInfo__outProvince").is(":checked"),d="";$(".outRequests__form__btnContainer__submit").click(l=>{if(l.preventDefault(),data2send.table="out_requests",a.val().match(/\d{6}/)&&!a.val().match(/\d{7,}/)||invalid(a),""===t.val()&&invalid(t),""===s.val()&&invalid(s),""===n.val()&&invalid(n),""===o.val()&&invalid(o),""===_.val()&&invalid(_),""===i.val()&&invalid(i),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".outRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout(()=>{data2send.values.push(a.val()),data2send.values.push(t.val()),data2send.values.push(new Date(s.val()).toUTCString()),data2send.values.push(n.val()),data2send.values.push(o.val()),-1!==_.val().indexOf(",")?(d=_.val().split(","),data2send.values.push(d[0].toUpperCase().trim(),d[1].trim())):(d=_.val(),data2send.values.push(d),data2send.authorFirstName=!1),data2send.values.push(i.val()),data2send.values.push(u),socket.emit("append data",data2send),data2send.values=[],$(".outRequests__step3").fadeOut((function(){confirmation(),$(this).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})),$(".outRequests__form .input").not(".outRequests__form__pibInfo__requestDate, .outRequests__form__pibInfo__loanLibrary").val("")},5e3)}),$(".outRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{smartHide(".confirmation","out",e)})};outRequests();const returnDocument=(e,t)=>{let n;$(t).click(()=>{confirmation(),n=setTimeout(()=>{$(e).fadeOut(()=>{confirmation(),$(e).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__container__icon, .header__container__msg").toggleClass("hidden")})},5e3)}),$(".confirmation__body__cancel").click(()=>{clearTimeout(n)})},sendDeletion=e=>{$(e+"__btn").click(t=>{t.preventDefault();let n="";n=".outReturns__step3"===e?"out_requests":"in_requests",console.log({table:n,data:$(e+"__input").val()}),socket.emit("delete data",{table:n,data:$(e+"__input").val()})})};returnDocument(".inReturns__step3",".inReturns__step3__confirmation"),returnDocument(".outReturns__step3",".outReturns__step3__confirmation"),sendDeletion(".outReturns__step3"),sendDeletion(".inReturns__step3");const search=()=>{let e={table:"",reader:"",title:"",getReader:!1,getTitle:!0};$(".search__container__select").on("change",(function(){"out_requests"===$(this).val()?($(".search__container__readerInput").attr("disabled",!0),$(".search__container__titleInput").attr("disabled",!1)):"in_requests"===$(this).val()||"drafts"===$(this).val()?$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!1):"default"===$(this).val()&&$(".search__container__titleInput, .search__container__readerInput").attr("disabled",!0)})),$(".search__container").submit(a=>{a.preventDefault(),e.getReader=e.getTitle=!1,"default"!==$(".search__container__select").val()&&(e.table=$(".search__container__select").val()),""!==$(".search__container__readerInput").val()&&(e.getReader=!0,e.reader=$(".search__container__readerInput").val()),""!==$(".search__container__titleInput").val()&&(e.getTitle=!0,e.title=$(".search__container__titleInput").val()),socket.emit("search",e),e.table=e.reader=e.title="",e.getReader=e.getTitle=!1}),socket.on("search results",e=>{$(".search__results__container").empty((function(){$(this).fadeOut()}));let a=$("<span></span>").addClass("search__results__container__header flex").appendTo(".search__results__container");for(const[_,r]of Object.keys(e[0]).entries()){let e=r;if("in_requests"===$(".search__container__select").val()?"borrowing_library"===r&&(e="PrÃªteur"):"out_requests"===$(".search__container__select").val()&&"borrowing_library"===r&&(e="Emprunteur"),"loan_library"!==r&&"book_author_firstname"!==r){switch(r){case"pib_number":e="NÂ° PIB";break;case"request_date":e="Date";break;case"book_title":e="Titre";break;case"book_author_name":e="Auteur";break;case"cdu":e="CDU";break;case"out_province":e="Hors Province ?";break;case"barcode":e="NÂ° inv.";break;case"id":e="NÂ° de demande";break;case"comment":e="Commentaires";break;case"reader_name":e="Lecteur"}$("<span></span>").addClass("search__results__container__header__item").text(e).appendTo(a)}}for(const[a,_]of e.entries()){let e=$("<span></span>").addClass("search__results__container__row flex").appendTo(".search__results__container");if(void 0!==_.id){$("<span></span>").addClass("search__results__container__row__item").append(_.id).appendTo(e)}if(void 0!==_.pib_number){$("<span></span>").addClass("search__results__container__row__item").append(_.pib_number).appendTo(e)}if(void 0!==_.borrowing_library){$("<span></span>").addClass("search__results__container__row__item").append(_.borrowing_library).appendTo(e)}let a=$("<span></span>").addClass("search__results__container__row__item");if(null!==_.request_date?a.append(new Date(_.request_date).toLocaleDateString()):a.append("ProblÃ¨me d'affichage..."),a.appendTo(e),void 0!==_.reader_name){$("<span></span>").addClass("search__results__container__row__item").append(_.reader_name).appendTo(e)}$("<span></span>").addClass("search__results__container__row__item").append(_.book_title).appendTo(e);let r=$("<span></span>").addClass("search__results__container__row__item");if(void 0===_.book_author_name&&void 0===_.book_author_firstname||(void 0!==_.book_author_firstname&&null!==_.book_author_firstname?r.append(`${_.book_author_name}, ${_.book_author_firstname}`):r.append(_.book_author_name),r.appendTo(e)),void 0!==_.cdu){$("<span></span>").addClass("search__results__container__row__item").append(_.cdu).appendTo(e)}let t=$("<input>").addClass("search__results__container__row__item");if(void 0!==_.out_province&&(t.attr("type","checkbox").attr("disabled",!0).appendTo(e),_.out_province?t.attr("checked",!0):t.attr("checked",!1)),void 0!==_.barcode){$("<span></span>").addClass("search__results__container__row__item").append(_.barcode).appendTo(e)}if(void 0!==_.comment){$("<span></span>").addClass("search__results__container__row__item").append(_.comment.replace(/\n/gi,"<br>")).appendTo(e)}}$(".search__results__container").fadeIn()})};search();