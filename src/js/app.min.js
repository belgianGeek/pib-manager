const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".wrapper, .header").toggleClass("blur")};const handleHomeBtnClick=e=>{$(`.home__btnContainer__${e}`).click(()=>{$(".home").fadeOut(()=>{$(`.${e}__step1`).fadeIn(()=>{$(`.${e}__step1`).toggleClass("hidden flex").removeAttr("style")}),setTimeout(()=>{$(".home").toggleClass("flex hidden").removeAttr("style"),$(".returnIcon, .header__msg").removeClass("hidden")},1e3)})})};handleHomeBtnClick("outRequests"),handleHomeBtnClick("inRequests"),handleHomeBtnClick("inReturns"),handleHomeBtnClick("outReturns");const socket=io();let day,month,data2send={table:"",values:[],authorFirstName:!0},validationErr=!1;day=(new Date).getDate()<"10"?`0${(new Date).getDate()}`:(new Date).getDate(),month=(new Date).getMonth()<"10"?`0${(new Date).getMonth()+1}`:(new Date).getMonth()+1;const handleSimpleStep=(e,t,s,n)=>{$(`${e}__${t}__${n}`).click(()=>{validationErr||($(`${e}__${t}`).toggleClass("translateXbackwards hidden flex"),setTimeout(()=>{$(`${e}__${s}`).fadeIn().removeAttr("style").removeClass("translateXonwards hidden").toggleClass("fixed flex")},1e3))})};handleSimpleStep(".inRequests","step2","step3","btn"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".inReturns","step1","step2","btn"),handleSimpleStep(".inReturns","step2","step3","confirmation"),handleSimpleStep(".outReturns","step1","step2","btn"),handleSimpleStep(".outReturns","step2","step3","confirmation"),$(".inRequests__step3__btn, .outRequests__step2__btn",".inReturns__step2__btn",".outReturns__step2__btn").click(()=>{window.open("https://www.samarcande-bibliotheques.be/pro/")}),$(".returnIcon").click(()=>{const e=(e,t)=>{var s;".outRequests__step1"===e||".inRequests__step1"===e||".inReturns__step1"===e||".outReturns__step1"===e?$(e).is(":visible")&&(s=e,$(s).removeClass("translateXbackwards").toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__msg").toggleClass("hidden"),setTimeout(()=>{$(s).toggleClass("translateXonwards flex")},500)):$(e).is(":visible")&&($(e).toggleClass("translateXonwards flex hidden"),$(t).removeClass("translateXbackwards").toggleClass("hidden flex"))};e(".outRequests__step1"),e(".inRequests__step1"),e(".inReturns__step1"),e(".outReturns__step1"),e(".outRequests__step2",".outRequests__step1"),e(".outRequests__step3",".outRequests__step2"),e(".inRequests__step2",".inRequests__step1"),e(".inRequests__step3",".inRequests__step2"),e(".inReturns__step2",".inReturns__step1"),e(".inReturns__step3",".inReturns__step2"),e(".outReturns__step2",".outReturns__step1"),e(".outReturns__step3",".outReturns__step2")});socket.on("notification",i=>{"success"===i.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").addClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===i.type&&($(".notification__icon").attr("src","./src/scss/icons/error.svg"),$(".notification").addClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")),$(".notification").toggleClass("hidden flex notificationTranslate"),setTimeout(()=>{$(".notification").fadeOut(()=>{$(".notification").removeAttr("style").removeClass("notificationSuccess notificationFailure").toggleClass("flex hidden notificationTranslate")})},5e3)});const inRequests=()=>{$(".inRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${month}-${day}`);let e,s=$(".inRequests__form__docInfo__inv");socket.on("barcode",e=>{$("#inRequests__barcode__svg").length?($("#inRequests__barcode__svg").replaceWith(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")):($(".inRequests__barcode").append(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")),s.val(e.number)});let _,t,a="#inRequests__form__readerInfo__dataset",n=$(".inRequests__form__readerInfo__name"),i=$(".inRequests__form__pibInfo__pibNb"),o=$(".inRequests__form__pibInfo__borrowingLibrary"),r=$(".inRequests__form__pibInfo__requestDate"),d=$(".inRequests__form__pibInfo__loanLibrary"),l=$(".inRequests__form__docInfo__title"),u=$(".inRequests__form__docInfo__author"),v=$(".inRequests__form__docInfo__cdu"),m=$(".inRequests__form__pibInfo__outProvince").is(":checked"),c="";n.keyup(()=>{socket.emit("retrieve readers",n.val())}),socket.on("readers retrieved",e=>{for(const s of e){$("<option></option").append(s.name).appendTo(a)}}),n.focusout(()=>{$(a).empty()}),$(`${a} option`).on("click",()=>{$(a).empty()});let f=$(".inRequests__form__docInfo__inv").val();$(".inRequests__form__btnContainer__submit").click(e=>{if(e.preventDefault(),data2send.table="in_requests",i.val().match(/\d{6}/)||invalid(i),""===o.val()&&invalid(o),""===r.val()&&invalid(r),""===d.val()&&invalid(d),""===n.val()&&invalid(n),""!==l.val()?_=l.val():invalid(l),""!==u.val()?t=u.val():invalid(u),""===v.val()&&invalid(v),""===s.val()&&invalid(s.val()),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1}else $(".input").removeClass("invalid"),$("form .warning").hide(),$("#inRequests__barcode__svg").clone().appendTo(".inRequests__step2__barcode"),$(".inRequests__step2__reminder__content__item__title").text(_),$(".inRequests__step2__reminder__content__item__author").text(t),$(".inRequests__step2__reminder__content__item__inv").text(f),$(".inRequests__step1").fadeOut(()=>{$(".inRequests__step1").removeAttr("style").toggleClass("hidden flex")}),$(".inRequests__step2").fadeIn().removeAttr("style").removeClass("translateXonwards translateXbackwards hidden").toggleClass("fixed flex");data2send.values=[]}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".inRequests__step3__confirmation").click(()=>{confirmation(),e=setTimeout(()=>{data2send.values.push(i.val()),data2send.values.push(o.val()),data2send.values.push(r.val()),data2send.values.push(d.val()),data2send.values.push(n.val()),data2send.email={send:!0,receiver:n.val()},data2send.values.push(l.val()),-1!==u.val().indexOf(",")?(c=u.val().split(","),data2send.values.push(c[0].toUpperCase().trim(),c[1].trim())):(c=u.val(),data2send.values.push(c),data2send.authorFirstName=!1),data2send.values.push(v.val()),data2send.values.push(m),data2send.values.push(s.val()),socket.emit("append data",data2send),data2send.values=[],$(".inRequests__step3").fadeOut(()=>{confirmation(),$(".inRequests__step2__barcode #inRequests__barcode__svg").remove(),$(".inRequests__form .input").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".inRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden")})},5e3)}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(e)}))})};inRequests();const invalid=e=>{e.addClass("invalid"),validationErr=!0},outRequests=()=>{let e="",a=$(".outRequests__form__pibInfo__pibNb"),t=$(".outRequests__form__pibInfo__borrowingLibrary"),s=$(".outRequests__form__pibInfo__requestDate"),o=$(".outRequests__form__pibInfo__loanLibrary"),_=$(".outRequests__form__docInfo__title"),n=$(".outRequests__form__docInfo__author"),i=$(".outRequests__form__docInfo__cdu"),l=$(".outRequests__form__pibInfo__outProvince").is(":checked"),u="";$(".outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${month}-${day}`),$(".outRequests__form__btnContainer__submit").click(d=>{if(d.preventDefault(),data2send.table="out_requests",a.val().match(/\d{6}/)||invalid(a),""===t.val()&&invalid(t),""===s.val()&&invalid(s),""===o.val()&&invalid(o),""===_.val()&&invalid(_),""===n.val()&&invalid(n),""===i.val()&&invalid(i),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".outRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),e=setTimeout(()=>{data2send.values.push(a.val()),data2send.values.push(t.val()),data2send.values.push(s.val()),data2send.values.push(o.val()),data2send.values.push(_.val()),-1!==n.val().indexOf(",")?(u=n.val().split(","),data2send.values.push(u[0].toUpperCase().trim(),u[1].trim())):(u=n.val(),data2send.values.push(u),data2send.authorFirstName=!1),data2send.values.push(i.val()),data2send.values.push(l),socket.emit("append data",data2send),data2send.values=[],$(".outRequests__step3").fadeOut(()=>{confirmation(),$(".outRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden")}),$(".outRequests__form .input").not(".outRequests__form__pibInfo__requestDate, .outRequests__form__pibInfo__loanLibrary").val("")},5e3)}),$(".outRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(e)}))})};outRequests();const returnDocument=(e,t)=>{$(t).click(()=>{confirmation(),setTimeout(()=>{$(e).fadeOut(()=>{confirmation(),$(e).removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden")})},5e3)})},sendDeletion=e=>{$(`${e}__btn`).click(t=>{t.preventDefault();let n="";n=".outReturns__step3"===e?"out_requests":"in_requests",console.log({table:n,data:$(`${e}__input`).val()}),socket.emit("delete data",{table:n,data:$(`${e}__input`).val()})})};returnDocument(".inReturns__step3",".inReturns__step3__confirmation"),returnDocument(".outReturns__step3",".outReturns__step3__confirmation"),sendDeletion(".outReturns__step3"),sendDeletion(".inReturns__step3");