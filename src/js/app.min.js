const confirmation=()=>{$(".confirmation").toggleClass("hidden flex"),$(".wrapper, .header").toggleClass("blur")};const handleHomeBtnClick=e=>{$(`.home__btnContainer__${e}`).click(()=>{$(".home").fadeOut(()=>{$(`.${e}__step1`).fadeIn(()=>{$(`.${e}__step1`).toggleClass("hidden flex").removeAttr("style")}),setTimeout(()=>{$(".home").toggleClass("flex hidden").removeAttr("style"),$(".returnIcon, .header__msg").removeClass("hidden")},1e3)})})};handleHomeBtnClick("outRequests"),handleHomeBtnClick("inRequests"),handleHomeBtnClick("inReturns");const socket=io();let day,month,data2send={table:"",values:[],authorFirstName:!0},validationErr=!1;day=(new Date).getDate()<"10"?`0${(new Date).getDate()}`:(new Date).getDate(),month=(new Date).getMonth()<"10"?`0${(new Date).getMonth()+1}`:(new Date).getMonth()+1;const handleSimpleStep=(e,s,t,a)=>{$(`${e}__${s}__${a}`).click(()=>{validationErr||($(`${e}__${s}`).toggleClass("translateXbackwards hidden flex"),setTimeout(()=>{$(`${e}__${t}`).fadeIn().removeAttr("style").removeClass("translateXonwards hidden").toggleClass("fixed flex")},1e3))})};handleSimpleStep(".inRequests","step2","step3","btn"),handleSimpleStep(".outRequests","step1","step2","btn"),handleSimpleStep(".outRequests","step2","step3","confirmation"),handleSimpleStep(".inReturns","step1","step2","btn"),$(".inRequests__step3__btn, .outRequests__step2__btn").click(()=>{window.open("https://www.samarcande-bibliotheques.be/pro/")}),$(".returnIcon").click(()=>{const e=e=>{$(e).toggleClass("translateXonwards hidden"),$(".home").toggleClass("hidden flex"),$(".returnIcon, .header__msg").toggleClass("hidden"),setTimeout(()=>{$(e).toggleClass("translateXonwards flex")},500)};$(".outRequests__step1").is(":visible")?e(".outRequests__step1"):$(".outRequests__step2").is(":visible")?($(".outRequests__step2").toggleClass("translateXonwards flex hidden"),$(".outRequests__step1").toggleClass("translateXbackwards hidden flex")):$(".outRequests__step3").is(":visible")?($(".outRequests__step3").toggleClass("translateXonwards flex hidden"),$(".outRequests__step2").toggleClass("translateXbackwards hidden flex")):$(".inRequests__step1").is(":visible")?e(".inRequests__step1"):$(".inRequests__step2").is(":visible")?($(".inRequests__step2").toggleClass("translateXonwards flex hidden"),$(".inRequests__step1").removeClass("translateXbackwards").toggleClass("hidden flex")):$(".inRequests__step3").is(":visible")?($(".inRequests__step3").toggleClass("translateXonwards flex hidden"),$(".inRequests__step2").toggleClass("translateXbackwards hidden flex")):$(".inReturns__step1").is(":visible")?e(".inReturns__step1"):$(".inReturns__step2").is(":visible")&&($(".inReturns__step2").toggleClass("translateXonwards flex hidden"),$(".inReturns__step1").toggleClass("translateXbackwards hidden flex"))});socket.on("notification",t=>{"success"===t.type?($(".notification__icon").attr("src","./src/scss/icons/thumbs-up.svg"),$(".notification").toggleClass("notificationSuccess"),$(".notification__msg").text("Changements enregistrÃ©s avec succÃ¨s ! ðŸ˜‰")):"error"===t.type&&($(".notification__icon").attr("src","./src/scss/icons/alert.svg"),$(".notification").toggleClass("notificationFailure"),$(".notification__msg").text("Une erreur s'est produite... ðŸ˜±")),$(".notification").toggleClass("hidden flex notificationTranslate"),setTimeout(()=>{$(".notification").fadeOut(()=>{$(".notification").removeAttr("style").toggleClass("flex hidden notificationTranslate")})},2e3)});$(".inRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${month}-${day}`);let inRequestsTimeOut,barcode=$(".inRequests__form__docInfo__inv");socket.on("barcode",e=>{$("#inRequests__barcode__svg").length?($("#inRequests__barcode__svg").replaceWith(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")):($(".inRequests__barcode").append(e.code),$(".inRequests__barcode svg").attr("id","inRequests__barcode__svg")),barcode.val(e.number)});let reminderTitle,reminderAuthor,dataset="#inRequests__form__readerInfo__dataset",readerName=$(".inRequests__form__readerInfo__name");readerName.keyup(()=>{socket.emit("retrieve readers",readerName.val())}),socket.on("readers retrieved",e=>{for(const a of e)if(!$(`${dataset} .${a.name}`).length){$("<option></option").addClass(a.name).append(a.name).appendTo(dataset)}}),$(readerName).focusout(()=>{$(dataset).empty()}),$(`${dataset} option`).on("click",()=>{$(dataset).empty()});let reminderInv=$(".inRequests__form__docInfo__inv").val();$(".inRequests__form__btnContainer__submit").click(e=>{e.preventDefault(),data2send.table="in_requests";let a=$(".inRequests__form__pibInfo__pibNb");a.val().match(/\d{6}/)?data2send.values.push(a.val()):invalid(a);let t=$(".inRequests__form__pibInfo__borrowingLibrary");""!==t.val()?data2send.values.push(t.val()):invalid(t);let s=$(".inRequests__form__pibInfo__requestDate");""!==s.val()?data2send.values.push(s.val()):invalid(s);let _=$(".inRequests__form__pibInfo__loanLibrary");""!==_.val()?data2send.values.push(_.val()):invalid(_),""!==readerName.val()?(data2send.values.push(readerName.val()),data2send.email={send:!0,receiver:readerName.val()}):invalid(readerName);let n=$(".inRequests__form__docInfo__title");""!==n.val()?(data2send.values.push(n.val()),reminderTitle=n.val()):invalid(n);let i="",r=$(".inRequests__form__docInfo__author");""!==r.val()?-1!==r.val().indexOf(",")?(i=r.val().split(","),data2send.values.push(i[0].toUpperCase().trim(),i[1].trim()),reminderAuthor=`${i[0].toUpperCase().trim()}, ${i[1].trim()}`):(i=reminderAuthor=r.val(),data2send.values.push(i),data2send.authorFirstName=!1):invalid(r);let d=$(".inRequests__form__docInfo__cdu");""!==d.val()?data2send.values.push(d.val()):invalid(d);let o=$(".inRequests__form__pibInfo__outProvince").is(":checked");if(data2send.values.push(o),""!==barcode.val()?data2send.values.push(barcode.val()):invalid(barcode.val()),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".inRequests__form")}validationErr=!1}else $(".input").removeClass("invalid"),$("form .warning").hide(),$("#inRequests__barcode__svg").clone().appendTo(".inRequests__step2__barcode"),$(".inRequests__step2__reminder__content__item__title").text(reminderTitle),$(".inRequests__step2__reminder__content__item__author").text(reminderAuthor),$(".inRequests__step2__reminder__content__item__inv").text(reminderInv),$(".inRequests__step1").fadeOut(()=>{$(".inRequests__step1").removeAttr("style").toggleClass("hidden flex")}),$(".inRequests__step2").fadeIn().removeAttr("style").removeClass("translateXonwards translateXbackwards hidden").toggleClass("fixed flex");data2send.values=[]}),$(".inRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".inRequests__step3__confirmation").click(()=>{confirmation(),inRequestsTimeOut=setTimeout(()=>{$(".inRequests__step3").fadeOut(()=>{confirmation(),$(".inRequests__step2__barcode #inRequests__barcode__svg").remove(),$(".inRequests__form .input").not(".inRequests__form__pibInfo__requestDate, .inRequests__form__pibInfo__loanLibrary, .inRequests__form__docInfo__inv").val(""),$(".inRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden"),socket.emit("append data",data2send)})},5e3)}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(inRequestsTimeOut)}))});const invalid=e=>{e.addClass("invalid"),validationErr=!0};let outRequestsTimeOut="";$(".outRequests__form__pibInfo__requestDate").val(`${(new Date).getFullYear()}-${month}-${day}`),$(".outRequests__form__btnContainer__submit").click(e=>{e.preventDefault(),data2send.table="out_requests";let t=$(".outRequests__form__pibInfo__pibNb");t.val().match(/\d{6}/)?data2send.values.push(t.val()):invalid(t);let a=$(".outRequests__form__pibInfo__borrowingLibrary");""!==a.val()?data2send.values.push(a.val()):invalid(a);let s=$(".outRequests__form__pibInfo__requestDate");""!==s.val()?data2send.values.push(s.val()):invalid(s);let o=$(".outRequests__form__pibInfo__loanLibrary");""!==o.val()?data2send.values.push(o.val()):invalid(o);let _=$(".outRequests__form__docInfo__title");""!==_.val()?data2send.values.push(_.val()):invalid(_);let i="",n=$(".outRequests__form__docInfo__author");""!==n.val()?-1!==n.val().indexOf(",")?(i=n.val().split(","),data2send.values.push(i[0].toUpperCase().trim(),i[1].trim())):(i=n.val(),data2send.values.push(i),data2send.authorFirstName=!1):invalid(n);let l=$(".outRequests__form__docInfo__cdu");""!==l.val()?data2send.values.push(l.val()):invalid(l);let u=$(".outRequests__form__pibInfo__outProvince").is(":checked");if(data2send.values.push(u),validationErr){if(!$("form .warning").length){$("<span></span>").addClass("warning").text("Certains champs sont incorrects...").appendTo(".outRequests__form")}validationErr=!1,data2send.values=[]}else $(".input").removeClass("invalid"),$("form .warning").hide(),confirmation(),outRequestsTimeOut=setTimeout(()=>{$(".outRequests__step3").fadeOut(()=>{confirmation(),$(".outRequests__step3").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden")}),$(".outRequests__form .input").not(".outRequests__form__pibInfo__requestDate, .outRequests__form__pibInfo__loanLibrary").val(""),socket.emit("append data",data2send)},5e3)}),$(".outRequests__form__btnContainer__reset").click(()=>{$(".input").removeClass("invalid"),$("form .warning").hide(),validationErr=!1,data2send.values=[]}),$(".confirmation__body__cancel").click(()=>{$(".confirmation").fadeOut((function(){$(this).addClass("hidden").removeClass("flex").removeAttr("style"),$(".wrapper, .header").removeClass("blur"),clearTimeout(outRequestsTimeOut)}))});$(".inReturns__step2__btn").click(e=>{e.preventDefault(),socket.emit("delete data",{table:"in_requests",barcode:$(".inReturns__step2__input").val()})}),$(".inReturns__step2__confirmation").click(()=>{confirmation(),setTimeout(()=>{$(".inReturns__step2").fadeOut(()=>{confirmation(),$(".inReturns__step2").removeAttr("style").toggleClass("hidden flex"),$(".home").toggleClass("hidden flex"),$(".header__icon, .header__msg").toggleClass("hidden")})},5e3)});